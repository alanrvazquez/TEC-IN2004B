<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.42">

  <meta name="author" content="Alan R. Vazquez">
  <title>IN2004B Generation of Value with Data Analytics – Predictive Models and Time Series</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-2f366650f320edcfcf53d73c80250a32.css">
  <link rel="stylesheet" href="style.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Predictive Models and Time Series</h1>
  <p class="subtitle">IN2004B: Generation of Value with Data Analytics</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Alan R. Vazquez 
</div>
        <p class="quarto-title-affiliation">
            Department of Industrial Engineering
          </p>
    </div>
</div>

</section>
<section id="agenda" class="slide level2">
<h2>Agenda</h2>
<p><br></p>
<ol type="1">
<li>Introduction</li>
<li>Time Series</li>
<li>Linear Regression Model for Time Series</li>
</ol>
</section>
<section>
<section id="introduction" class="title-slide slide level1 center">
<h1>Introduction</h1>

</section>
<section id="load-the-libraries" class="slide level2">
<h2>Load the libraries</h2>
<p><br></p>
<p>Before we start, let’s import the data science libraries into Python.</p>
<div id="8b8ec19b" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-6"><a></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb1-7"><a></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score, PredictionErrorDisplay</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, we use specific functions from the <strong>pandas</strong>, <strong>matplotlib</strong>, <strong>seaborn</strong> and <strong>sklearn</strong> libraries in Python.</p>
</section>
<section id="main-data-science-problems" class="slide level2">
<h2>Main data science problems</h2>
<p><br></p>
<p><span style="color:green;"><strong>Regression Problems</strong></span>. The response is numerical. For example, a person’s income, the value of a house, or a patient’s blood pressure.</p>
<p><span style="color:blue;"><strong>Classification Problems</strong></span>. The response is categorical and involves <em>K</em> different categories. For example, the brand of a product purchased (A, B, C) or whether a person defaults on a debt (yes or no).</p>
<p>The predictors (<span class="math inline">\(\boldsymbol{X}\)</span>) can be <em>numerical</em> or <em>categorical</em>.</p>
</section>
<section id="main-data-science-problems-1" class="slide level2">
<h2>Main data science problems</h2>
<p><br></p>
<p><span style="color:green;"><strong>Regression Problems</strong></span>. The response is numerical. For example, a person’s income, the value of a house, or a patient’s blood pressure.</p>
<p><span style="color:gray;"><strong>Classification Problems</strong>. The response is categorical and involves <em>K</em> different categories. For example, the brand of a product purchased (A, B, C) or whether a person defaults on a debt (yes or no).</span></p>
<p>The predictors (<span class="math inline">\(\boldsymbol{X}\)</span>) can be <em>numerical</em> or <em>categorical</em>.</p>
</section>
<section id="regression-problem" class="slide level2">
<h2>Regression problem</h2>
<p><br></p>
<p><strong>Goal</strong>: Find the best function <span class="math inline">\(f(\mathbf{X})\)</span> of the predictors <span class="math inline">\(\mathbf{X} = (X_1, \ldots, X_p)\)</span> that describes the response <span class="math inline">\(Y\)</span>.</p>
<p>In mathematical terms, we want to establish the following relationship:</p>
<p><span class="math display">\[Y = f(\mathbf{X}) + \epsilon\]</span></p>
<ul>
<li>Where <span class="math inline">\(\epsilon\)</span> is a natural (random) error.</li>
</ul>
</section>
<section id="how-to-find-the-shape-of-fx" class="slide level2">
<h2>How to find the shape of <span class="math inline">\(f(X)\)</span>?</h2>
<p><br></p>
<p>Using training data. <img data-src="images/TrainVal1.png" class="quarto-figure quarto-figure-center"></p>
</section>
<section id="how-to-find-the-shape-of-fx-1" class="slide level2">
<h2>How to find the shape of <span class="math inline">\(f(X)\)</span>?</h2>
<p><br></p>
<p>Using training data.</p>

<img data-src="images/TrainVal2.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="how-to-evaluate-the-quality-of-the-candidate-function-hatfx" class="slide level2">
<h2>How to evaluate the quality of the candidate function <span class="math inline">\(\hat{f}(X)\)</span>?</h2>
<div class="center">
<div class="columns">
<div class="column" style="width:40%;">
<p>Using validation data.</p>
</div><div class="column" style="width:60%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/TrainVal3.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div></div>
</div>
</section>
<section id="how-to-evaluate-the-quality-of-the-candidate-function-hatfx-1" class="slide level2">
<h2>How to evaluate the quality of the candidate function <span class="math inline">\(\hat{f}(X)\)</span>?</h2>
<div class="center">
<div class="columns">
<div class="column" style="width:40%;">
<p>Using validation data.</p>
</div><div class="column" style="width:60%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/TrainVal4.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div></div>
</div>
</section>
<section id="moreover" class="slide level2">
<h2>Moreover…</h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:40%;">
<p>We can use <span style="color:darkgreen;"><strong><em>test data</em></strong></span> for a final evaluation of the model.</p>
<p>Test data is data obtained from the process that generated the training data.</p>
<p>Test data is independent of the training data.</p>
</div><div class="column" style="width:60%;">
<p><br></p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/TrainVal5.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div></div>
</div>
</section>
<section id="linear-regression-model" class="slide level2">
<h2>Linear regression model</h2>
<p>A common candidate function for predicting a response is the linear regression model. It has the mathematical form:</p>
<p><span class="math display">\[\hat{Y}_i = \hat{f}(X_i) = \hat{\beta}_0 + \hat{\beta}_1 X_i.\]</span></p>
<ul>
<li><p>Where <span class="math inline">\(i = 1, \ldots, n_t\)</span> is the index of the <span class="math inline">\(n_t\)</span> training data.</p></li>
<li><p><span class="math inline">\(\hat{Y}_i\)</span> is the prediction of the actual value of the response <span class="math inline">\(Y_i\)</span> associated with a predictor value equal to <span class="math inline">\(X_i\)</span>.</p></li>
<li><p><span class="math inline">\(\hat{\beta}_0\)</span> and <span class="math inline">\(\hat{\beta}_1\)</span> are called the <span style="color:lightblue;"><em>estimated coefficients</em></span> of the model.</p></li>
</ul>
</section>
<section id="section" class="slide level2">
<h2></h2>
<p>The values of <span class="math inline">\(\hat{\beta}_0\)</span> and <span class="math inline">\(\hat{\beta}_1\)</span> are obtained using the training dataset and the least squares method.</p>
<p>This method finds the values of <span class="math inline">\(\hat{\beta}_0\)</span> and <span class="math inline">\(\hat{\beta}_1\)</span> that minimize the error made by the model <span class="math inline">\(\hat{f}(X_i)\)</span> when trying to predict the responses of the training dataset.</p>
<p><br></p>
<div class="fragment">
<p>Technically, the least squares method finds the <span class="math inline">\(\hat{\beta}_0\)</span> and <span class="math inline">\(\hat{\beta}_1\)</span> that minimize the following expression</p>
<div style="font-size: 75%;">
<p><span class="math display">\[(Y_1 - (\hat{\beta}_0 + \hat{\beta}_1 X_1 ))^2 + (Y_2 - (\hat{\beta}_0 + \hat{\beta}_1 X_2 ))^2 + \cdots + (Y_{n_t} - (\hat{\beta}_0 + \hat{\beta}_1 X_{n_t} ))^2 \]</span></p>
</div>
<p>For the <span class="math inline">\(n_t\)</span> observations in the <span style="color:blue;">training data</span>!</p>
</div>
</section>
<section id="the-idea-in-two-dimensions" class="slide level2">
<h2>The idea in two dimensions</h2>

<img data-src="images/Modulo 3 - Modelos predictivos y series de tiempo copy.012.jpeg" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="example-1" class="slide level2">
<h2>Example 1</h2>
<p><br></p>
<p>We used the dataset called “Advertising.xlsx” in Canvas.</p>
<ul>
<li>TV: Money spent on TV ads for a product ($).</li>
<li>Sales: Sales generated from the product ($).</li>
<li>200 markets</li>
</ul>
<div id="adff712a" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a></a><span class="co"># Load the data into Python</span></span>
<span id="cb2-2"><a></a>Ads_data <span class="op">=</span> pd.read_excel(<span class="st">'Advertising.xlsx'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-1" class="slide level2">
<h2></h2>
<p><br></p>
<div id="58094926" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a></a>Ads_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TV</th>
<th data-quarto-table-cell-role="th">Radio</th>
<th data-quarto-table-cell-role="th">Newspaper</th>
<th data-quarto-table-cell-role="th">Sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>230.1</td>
<td>37.8</td>
<td>69.2</td>
<td>22.1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>44.5</td>
<td>39.3</td>
<td>45.1</td>
<td>10.4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>17.2</td>
<td>45.9</td>
<td>69.3</td>
<td>9.3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>151.5</td>
<td>41.3</td>
<td>58.5</td>
<td>18.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>180.8</td>
<td>10.8</td>
<td>58.4</td>
<td>12.9</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="section-2" class="slide level2">
<h2></h2>
<p><br><br></p>
<p>Now, let’s choose our predictor and response.</p>
<div id="412ec213" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a></a><span class="co"># Chose the predictor.</span></span>
<span id="cb4-2"><a></a>X_full <span class="op">=</span> Ads_data.<span class="bu">filter</span>([<span class="st">'TV'</span>])</span>
<span id="cb4-3"><a></a></span>
<span id="cb4-4"><a></a><span class="co"># Set the response.</span></span>
<span id="cb4-5"><a></a>Y_full <span class="op">=</span> Ads_data.<span class="bu">filter</span>([<span class="st">'Sales'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-training-and-validation-data" class="slide level2">
<h2>Create training and validation data</h2>
<p><br></p>
<p>To evaluate a model’s performance on unobserved data, we split the current dataset into a training dataset and a validation dataset. To do this, we use <code>train_test_split()</code>.</p>
<div id="933507a5" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a></a>X_train, X_valid, Y_train, Y_valid <span class="op">=</span> train_test_split(X_full, Y_full, </span>
<span id="cb5-2"><a></a>                                                      test_size <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span id="cb5-3"><a></a>                                                      random_state <span class="op">=</span> <span class="dv">301655</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We use 75% of the data for training and the rest for validation.</p>
</section>
<section id="fit-a-linear-regression-model-in-python" class="slide level2">
<h2>Fit a linear regression model in Python</h2>
<p><br></p>
<p>In Python, we use the <code>LinearRegression()</code> and <code>fit()</code> functions from the <strong>scikit-learn</strong> to fit a linear regression model.</p>
<div id="7a7ef718" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a></a><span class="co"># 1. Create the linear regression model</span></span>
<span id="cb6-2"><a></a>LRmodel <span class="op">=</span> LinearRegression()</span>
<span id="cb6-3"><a></a></span>
<span id="cb6-4"><a></a><span class="co"># 2. Fit the model.</span></span>
<span id="cb6-5"><a></a>LRmodel.fit(X_train, Y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-3" class="slide level2">
<h2></h2>
<p>The following commands show the estimated coefficients of the model.</p>
<div id="e3bfdab8" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a></a><span class="bu">print</span>(<span class="st">"Coefficients:"</span>, LRmodel.coef_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coefficients: [[0.05185463]]</code></pre>
</div>
</div>
<p>We can also show the estimated intercept.</p>
<div id="9a44ab17" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a></a><span class="bu">print</span>(<span class="st">"Intercept:"</span>, LRmodel.intercept_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercept: [6.69303889]</code></pre>
</div>
</div>
<p><br></p>
<div class="fragment">
<p>The estimated model thus is</p>
<p><span class="math display">\[\hat{Y}_i = 6.69 + 0.051 X_i.\]</span></p>
</div>
</section>
<section id="linear-regression-model-assumptions" class="slide level2">
<h2>Linear regression model assumptions</h2>
<p><br></p>
<p>To use the regression model, the model errors <span class="math inline">\(e_i = Y_i - \hat{Y}_i\)</span> obtained on the <span style="color:blue;">training data</span> must meet three conditions:</p>
<ol type="1">
<li>On average, they must be equal to 0.</li>
<li>They must have the same dispersion or variability.</li>
<li>They must be independent of each other.</li>
</ol>
<p>These assumptions are evaluated using a <em>graphical analysis of residuals</em> (model errors).</p>
</section>
<section id="in-python" class="slide level2">
<h2>In Python</h2>
<p>For a residual analysis, we need to compute the residuals and predictions using the training dataset. Additionally, we place these objects together with the ID of the observations in a pandas dataframe for further processing.</p>
<div id="1eaabc70" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a></a><span class="co"># Fitted values.</span></span>
<span id="cb11-2"><a></a>fitted <span class="op">=</span> LRmodel.predict(X_train) <span class="op">+</span> <span class="dv">0</span><span class="op">*</span>Y_train</span>
<span id="cb11-3"><a></a></span>
<span id="cb11-4"><a></a><span class="co"># Residuals</span></span>
<span id="cb11-5"><a></a>residuals <span class="op">=</span> Y_train <span class="op">-</span> fitted</span>
<span id="cb11-6"><a></a></span>
<span id="cb11-7"><a></a><span class="co"># Construct a pandas data.frame</span></span>
<span id="cb11-8"><a></a>residual_data <span class="op">=</span> pd.DataFrame()</span>
<span id="cb11-9"><a></a>residual_data[<span class="st">"Fitted"</span>] <span class="op">=</span> fitted</span>
<span id="cb11-10"><a></a>residual_data[<span class="st">"Residuals"</span>] <span class="op">=</span> residuals</span>
<span id="cb11-11"><a></a>residual_data[<span class="st">"ID"</span>] <span class="op">=</span> residuals.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-4" class="slide level2">
<h2></h2>
<p>To validate assumptions 1 and 2, we use a “residuals versus fitted values” plot</p>
<div id="533c6fb2" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a></a><span class="co"># Residual vs Fitted Values Plot</span></span>
<span id="cb12-2"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb12-3"><a></a>sns.scatterplot(data <span class="op">=</span> residual_data, x <span class="op">=</span> <span class="st">"Fitted"</span>, y <span class="op">=</span> <span class="st">"Residuals"</span>)</span>
<span id="cb12-4"><a></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb12-5"><a></a>plt.title(<span class="st">'Residuals vs Fitted Values'</span>)</span>
<span id="cb12-6"><a></a>plt.xlabel(<span class="st">'Fitted (predicted) Values'</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb12-7"><a></a>plt.ylabel(<span class="st">'Residuals'</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb12-8"><a></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PredictiveModels_files/figure-revealjs/cell-11-output-1.png" class="quarto-figure quarto-figure-center" width="667" height="455"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="section-5" class="slide level2">
<h2></h2>
<p>To validate assumption 3, we use the “residuals versus time” plot. Here, we use the ID as a time variable.</p>
<div id="d4eab5af" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a></a><span class="co"># Residual vs ID Plot</span></span>
<span id="cb13-2"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb13-3"><a></a>sns.scatterplot(data <span class="op">=</span> residual_data, x <span class="op">=</span> <span class="st">"ID"</span>, y <span class="op">=</span> <span class="st">"Residuals"</span>)</span>
<span id="cb13-4"><a></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb13-5"><a></a>plt.title(<span class="st">'Residuals vs Time'</span>)</span>
<span id="cb13-6"><a></a>plt.xlabel(<span class="st">'ID'</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb13-7"><a></a>plt.ylabel(<span class="st">'Residuals'</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb13-8"><a></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PredictiveModels_files/figure-revealjs/cell-12-output-1.png" class="quarto-figure quarto-figure-center" width="667" height="455"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="prediction-error" class="slide level2">
<h2>Prediction error</h2>
<p>After estimating and validating the linear regression model, we can check the quality of its predictions on <span style="color:darkred;"><strong>unobserved</strong></span> data. That is, on the data in the <span style="color:orange;">validation set</span>.</p>
<p><br></p>
<p>One metric for this is the <strong>mean prediction error</strong> (MSE<span class="math inline">\(_v\)</span>):</p>
<div style="font-size: 65%;">
<p><span class="math display">\[\text{MSE}_v = \frac{(Y_1 - (\hat{\beta}_0 + \hat{\beta}_1 X_1 ))^2 + (Y_2 - (\hat{\beta}_0 + \hat{\beta}_1 X_2 ))^2 + \cdots + (Y_{n_v} - (\hat{\beta}_0 + \hat{\beta}_1 X_{n_v} ))^2}{n_v}\]</span></p>
</div>
<ul>
<li>For the <span class="math inline">\(n_v\)</span> observations in the the validation data!</li>
</ul>
<p>The smaller <span class="math inline">\(\text{MSE}_v\)</span>, the better the predictions.</p>
</section>
<section id="section-6" class="slide level2">
<h2></h2>
<p><br></p>
<p>In practice, the square root of the mean prediction error is used:</p>
<p><span class="math display">\[\text{RMSE}_v = \sqrt{\text{MSE}_v}.\]</span></p>
<p>The advantage of <span class="math inline">\(\text{RMSE}_v\)</span> is that it can be interpreted as:</p>
<blockquote>
<p>The average variability of a model prediction.</p>
</blockquote>
<p>For example, if <span class="math inline">\(\text{RMSE}_v = 1\)</span>, then a prediction of <span class="math inline">\(\hat{Y} = 5\)</span> will have an (average) error rate of <span class="math inline">\(\pm 1\)</span>.</p>
</section>
<section id="in-python-1" class="slide level2">
<h2>In Python</h2>
<p><br></p>
<p>To evaluate the model’s performance, we use the validation dataset. Specifically, we use the predictor matrix stored in <code>X_valid</code>.</p>
<p><br></p>
<p>In Python, we make the prediction using the pre-trained <code>LRmodel</code>.</p>
<div id="09287e52" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a></a>Y_pred <span class="op">=</span> LRmodel.predict(X_valid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-7" class="slide level2">
<h2></h2>
<p><br></p>
<p>To evaluate the model, we use the <em>mean squared error</em> in the Python <code>mse()</code> function. Recall that the responses from the validation dataset are in <code>Y_valid</code>, and the model predictions are in <code>Y_pred</code>.</p>
<div id="bc08a930" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a></a>mse <span class="op">=</span> mean_squared_error(Y_valid, Y_pred)  <span class="co"># Mean Squared Error (MSE)</span></span>
<span id="cb15-2"><a></a><span class="bu">print</span>(<span class="bu">round</span>(mse, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>15.49</code></pre>
</div>
</div>
<p><br></p>
<p>To obtain the <strong>root mean squared error (RMSE)</strong>, we simply take the square root of the MSE.</p>
<div id="2944b061" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a></a><span class="bu">print</span>(<span class="bu">round</span>(mse<span class="op">**</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>), <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>3.94</code></pre>
</div>
</div>
</section>
<section id="another-metric-r2" class="slide level2">
<h2>Another Metric: <span class="math inline">\(R^2\)</span></h2>
<ul>
<li><p>In the context of Data Science, <span class="math inline">\(R^2\)</span> can be interpreted as the <em>squared</em> correlation between the actual responses and those predicted by the model.</p></li>
<li><p>The higher the correlation, the better the agreement between the predicted and actual responses.</p></li>
</ul>
<p><br></p>
<p>We compute <span class="math inline">\(R^2\)</span> in Python as follows:</p>
<div id="72ec6157" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a></a>rtwo_sc <span class="op">=</span> r2_score(Y_valid, Y_pred)  <span class="co"># Rsquared</span></span>
<span id="cb19-2"><a></a><span class="bu">print</span>(<span class="bu">round</span>(rtwo_sc, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.33</code></pre>
</div>
</div>
</section>
<section id="mini-activity-cooperative-mode" class="slide level2">
<h2>Mini-Activity (<em>cooperative</em> mode)</h2>
<p><br><br></p>
<ol type="1">
<li><p>Consider the Advertising.xlsx dataset in Canvas.</p></li>
<li><p>Use a model to predict Sales that includes the Radio predictor (money spent on radio ads for a product ($)). What is the <span class="math inline">\(\text{RMSE}_v\)</span>?</p></li>
<li><p>Now, use a model to predict Sales that includes two predictors: TV and Radio. What is the <span class="math inline">\(\text{RMSE}_v\)</span>?</p></li>
<li><p>Which model do you prefer?</p></li>
</ol>
</section>
<section id="other-candidate-functions" class="slide level2">
<h2>Other candidate functions</h2>
<p>The linear regression model is one of the most common models for predicting a response. It is simple and easy to calculate and interpret. However, it can be limited for complex problems.</p>
<p>For this purpose, there are other, more advanced candidate functions <span class="math inline">\(\hat{f}(X)\)</span>, such as:</p>
<ul>
<li><p><em>K</em> nearest neighbors.</p></li>
<li><p>Decision or <em>regression</em> trees.</p></li>
<li><p>Ensamble methods (bagging and random forest).</p></li>
</ul>
</section></section>
<section>
<section id="time-series" class="title-slide slide level1 center">
<h1>Time Series</h1>

</section>
<section id="what-is-a-time-series" class="slide level2">
<h2>What is a time series?</h2>
<p><br></p>
<ul>
<li><p>It is a sequence of observations collected at successive time intervals.</p></li>
<li><p>Time series data is commonly used in fields such as finance, economics, weather forecasting, signal processing, and many others.</p></li>
<li><p>Analyzing time series data helps us understand patterns, trends, and behaviors over time, enabling prediction, anomaly detection, and decision-making.</p></li>
</ul>
</section>
<section id="example-2" class="slide level2">
<h2>Example 2</h2>

<img data-src="images/Tesla_stock_price.jpg" class="r-stretch"></section>
<section id="section-8" class="slide level2">
<h2></h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li><p>Technically, a time series is a set of observations about a (discrete) predictor <span class="math inline">\(T\)</span> and a response <span class="math inline">\(Y\)</span>.</p></li>
<li><p>Observations of <span class="math inline">\(Y\)</span> are recorded at the moments or times given by the predictor <span class="math inline">\(T\)</span>.</p></li>
<li><p>The special feature of the time series is that the <span style="color:lightblue;">observations of <span class="math inline">\(Y\)</span> are not independent!</span></p></li>
</ul>
</div><div class="column" style="width:40%;">
<table class="caption-top">
<thead>
<tr class="header">
<th>Day</th>
<th>T</th>
<th>Temperature (Y)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Monday</td>
<td>1</td>
<td>10</td>
</tr>
<tr class="even">
<td>Tuesday</td>
<td>2</td>
<td>12</td>
</tr>
<tr class="odd">
<td>Wednesday</td>
<td>3</td>
<td>15</td>
</tr>
<tr class="even">
<td>Thursday</td>
<td>4</td>
<td>14</td>
</tr>
<tr class="odd">
<td>Friday</td>
<td>5</td>
<td>18</td>
</tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="example-3-amtrak-data" class="slide level2">
<h2>Example 3: Amtrak data</h2>
<p><br></p>
<ul>
<li><p>The Amtrak train company in the USA collects data on the number of passengers traveling on its trains.</p></li>
<li><p>Records are available from January 1991 to March 2004.</p></li>
<li><p>The data is available in “Amtrak.xlsx” on Canvas.</p></li>
</ul>
<div id="e291be7f" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a></a>Amtrak_data <span class="op">=</span> pd.read_excel(<span class="st">'Amtrak.xlsx'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-9" class="slide level2">
<h2></h2>
<p><br></p>
<div id="c50fd948" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a></a>Amtrak_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Month</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">Ridership (in 000s)</th>
<th data-quarto-table-cell-role="th">Season</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1991-01-01</td>
<td>1</td>
<td>1708.917</td>
<td>Jan</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1991-02-01</td>
<td>2</td>
<td>1620.586</td>
<td>Feb</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1991-03-04</td>
<td>3</td>
<td>1972.715</td>
<td>Mar</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1991-04-04</td>
<td>4</td>
<td>1811.665</td>
<td>Apr</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1991-05-05</td>
<td>5</td>
<td>1974.964</td>
<td>May</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="time-series-plot-in-python" class="slide level2">
<h2>Time series plot in Python</h2>
<p>We can create a line graph to visualize the evolution of Amtrak train ridership over time using <code>lineplot</code> from <strong>seaborn</strong>.</p>
<div id="4dc86395" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb23-2"><a></a>sns.lineplot(x<span class="op">=</span><span class="st">'Month'</span>, y<span class="op">=</span><span class="st">'Ridership (in 000s)'</span>, data <span class="op">=</span> Amtrak_data)</span>
<span id="cb23-3"><a></a>plt.xlabel(<span class="st">'Month'</span>)</span>
<span id="cb23-4"><a></a>plt.ylabel(<span class="st">'Ridership'</span>)</span>
<span id="cb23-5"><a></a>plt.title(<span class="st">'Amtrak Ridership Over Time'</span>)</span>
<span id="cb23-6"><a></a>plt.tight_layout()</span>
<span id="cb23-7"><a></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PredictiveModels_files/figure-revealjs/cell-19-output-1.png" class="quarto-figure quarto-figure-center" width="566" height="374"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="informative-series" class="slide level2">
<h2>Informative Series</h2>
<p><br></p>
<p>An informative time series is a series that contains patterns that we can use to predict future values of the series.</p>
<p>The three possible patterns are:</p>
<div>
<ul>
<li class="fragment"><span style="color:darkgreen;"><strong>Trend</strong></span>: the series has an <strong>increasing/decreasing</strong> behavior.</li>
<li class="fragment"><span style="color:purple;"><strong>Seasonality</strong></span>: the series has a repeating <strong>cyclical</strong> pattern in its values.</li>
<li class="fragment"><span style="color:darkblue;"><strong>Autocorrelation</strong></span>: the series follows a pattern that can be described by <strong>previous</strong> values of the series.</li>
</ul>
</div>
</section>
<section id="example-4-airline-data" class="slide level2">
<h2>Example 4: Airline data</h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><p>This series has an upper <strong>trend</strong>.</p></li>
<li><p>This series has <strong>cyclical</strong> patterns in its values.</p></li>
<li><p>Although not immediately visible, we can use the previous values of the series to describe the future ones.</p></li>
</ul>
</div><div class="column" style="width:50%;">
<div id="58a7d6b7" class="cell" data-execution_count="19">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PredictiveModels_files/figure-revealjs/cell-20-output-1.png" class="quarto-figure quarto-figure-center" width="566" height="374"></p>
</figure>
</div>
</div>
</div>
</div></div>
</div>
</section>
<section id="non-informative-series-white-noise" class="slide level2">
<h2>Non-informative series: White noise</h2>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><p>White noise is a series whose values, on average, are <strong>0</strong> and have a constant variation.</p></li>
<li><p>Its values are also independent of each other.</p></li>
<li><p>It is used to describe random or <em>natural</em> error.</p></li>
</ul>
</div><div class="column" style="width:50%;">
<div id="e48c9226" class="cell" data-execution_count="20">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PredictiveModels_files/figure-revealjs/cell-21-output-1.png" class="quarto-figure quarto-figure-center" width="560" height="368"></p>
</figure>
</div>
</div>
</div>
</div></div>
</div>
</section></section>
<section>
<section id="linear-regression-model-for-time-series" class="title-slide slide level1 center">
<h1>Linear Regression Model for Time Series</h1>

</section>
<section id="linear-regression-model-1" class="slide level2">
<h2>Linear regression model</h2>
<p><br></p>
<p>The linear regression model is useful for capturing patterns in a time series. In this context, the model takes the form:</p>
<p><span class="math display">\[\hat{Y}_i = \hat{\beta}_0 + \hat{\beta}_1 T_i\]</span></p>
<ul>
<li><p>Where <span class="math inline">\(i = 1, \ldots, n_t\)</span> is the index of the <span class="math inline">\(n_t\)</span> training data.</p></li>
<li><p><span class="math inline">\(\hat{Y}_i\)</span> is the prediction of the actual value of the response <span class="math inline">\(Y_i\)</span> <em>at time</em> <span class="math inline">\(T_i\)</span>.</p></li>
</ul>
</section>
<section id="trend" class="slide level2">
<h2>Trend</h2>
<p><br></p>
<p>The trend of the time series is captured by the value of <span class="math inline">\(\hat{\beta}_1\)</span> at</p>
<p><span class="math display">\[\hat{Y}_i = \hat{\beta}_0 + \hat{\beta}_1 T_i\]</span></p>
<ul>
<li><p>If <span class="math inline">\(\hat{\beta}_1\)</span> is positive, the series has an upward trend.</p></li>
<li><p>If <span class="math inline">\(\hat{\beta}_1\)</span> is negative, the series has a downward trend.</p></li>
</ul>
<p>The values of <span class="math inline">\(\hat{\beta}_0\)</span> and <span class="math inline">\(\hat{\beta}_1\)</span> are obtained using the least squares method.</p>
</section>
<section id="model-evaluation" class="slide level2">
<h2>Model evaluation</h2>
<p><br></p>
<p>Remember that the errors of the linear regression model (<span class="math inline">\(e_i = Y_i - \hat{Y}_i\)</span>) must meet two conditions:</p>
<ol type="1">
<li><p>On average, they must be equal to 0.</p></li>
<li><p>They must have the same dispersion or variability.</p></li>
<li><p>They must be independent of each other.</p></li>
</ol>
<p>In the context of time series, <strong>this means that the model errors</strong> <span class="math inline">\(e_i\)</span> must behave like <span style="color:darkgray;">white noise</span> that contains no patterns.</p>
</section>
<section id="example-3-amtrak-data-cont." class="slide level2">
<h2>Example 3: Amtrak data (cont.)</h2>
<p><br></p>
<p>Let’s fit a linear regression model to the ridership data from Amtrak.</p>
<div id="f150e935" class="cell" data-execution_count="21">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PredictiveModels_files/figure-revealjs/cell-22-output-1.png" class="quarto-figure quarto-figure-center" width="560" height="368"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="creating-a-train-and-a-validation-data" class="slide level2">
<h2>Creating a train and a validation data</h2>
<p>In time series, the order of the data matters because each observation is tied to a specific point in time.</p>
<p>Unlike typical datasets where observations are independent of one another, time series data follows a sequence where past values influence future ones.</p>
<p>Because of this, we cannot randomly split the data using a function like <code>train_test_split()</code>. Doing so might result in a situation where the model learns from future values to predict past ones—which doesn’t make sense and would lead to overly optimistic performance.</p>
</section>
<section id="section-10" class="slide level2">
<h2></h2>
<p>Instead, we want to mimic real-world forecasting: train the model on earlier time periods and test it on later ones.</p>
<p>To help us do this properly, we use the code below.</p>
<div id="a57f172e" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a></a><span class="co"># Define the split point</span></span>
<span id="cb24-2"><a></a>split_ratio <span class="op">=</span> <span class="fl">0.8</span>  <span class="co"># 80% train, 20% validation</span></span>
<span id="cb24-3"><a></a>split_point <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Amtrak_data) <span class="op">*</span> split_ratio)</span>
<span id="cb24-4"><a></a></span>
<span id="cb24-5"><a></a><span class="co"># Split the data</span></span>
<span id="cb24-6"><a></a>Amtrak_train <span class="op">=</span> Amtrak_data[:split_point]</span>
<span id="cb24-7"><a></a>Amtrak_validation <span class="op">=</span> Amtrak_data[split_point:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This code ensures that the training data always comes before the validation data in time, preserving the temporal order. The proportion of data that goes to training is set using <code>split_ratio</code>.</p>
</section>
<section id="section-11" class="slide level2">
<h2></h2>
<p><br><br></p>
<div id="619d7eb9" class="cell" data-execution_count="23">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PredictiveModels_files/figure-revealjs/cell-24-output-1.png" class="quarto-figure quarto-figure-center" width="752" height="464"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fit-linear-regression-model" class="slide level2">
<h2>Fit linear regression model</h2>
<p>We first set the predictor and response.</p>
<div id="405d78f4" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a></a><span class="co"># Set predictor.</span></span>
<span id="cb25-2"><a></a>X_train <span class="op">=</span> Amtrak_train.<span class="bu">filter</span>([<span class="st">'t'</span>])</span>
<span id="cb25-3"><a></a></span>
<span id="cb25-4"><a></a><span class="co"># Set response.</span></span>
<span id="cb25-5"><a></a>Y_train <span class="op">=</span> Amtrak_train.<span class="bu">filter</span>([<span class="st">'Ridership (in 000s)'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Next, we fit the model using <code>LinearRegression()</code> and <code>fit()</code> from <strong>scikit-learn</strong>.</p>
<div id="d52f16f1" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a></a><span class="co"># 1. Create linear regression model.</span></span>
<span id="cb26-2"><a></a>LRmodelAmtrak <span class="op">=</span> LinearRegression()</span>
<span id="cb26-3"><a></a></span>
<span id="cb26-4"><a></a><span class="co"># 2. Fit the model to the training data.</span></span>
<span id="cb26-5"><a></a>LRmodelAmtrak.fit(X_train, Y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-12" class="slide level2">
<h2></h2>
<p><br></p>
<p>Let’s inspect the estimated coefficient for the predictor (<em>time</em>).</p>
<div id="52577514" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a></a><span class="bu">print</span>(LRmodelAmtrak.coef_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[-1.2818326]]</code></pre>
</div>
</div>
<p>And the intercept.</p>
<div id="27b43d3d" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a></a><span class="bu">print</span>(LRmodelAmtrak.intercept_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1810.77686661]</code></pre>
</div>
</div>
<p>The estimated model then is:</p>
<p><span class="math display">\[\hat{Y}_i = 1810.777 - 1.281 T_i.\]</span></p>
</section>
<section id="residual-analysis" class="slide level2">
<h2>Residual analysis</h2>
<p><br><br></p>
<p>We can validate the model using a residual analysis on the training data. To this end, we first compute the predicted values and residuals of the model.</p>
<div id="69da15d0" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a></a>Y_pred <span class="op">=</span> LRmodelAmtrak.predict(X_train) <span class="op">+</span> Y_train<span class="op">*</span><span class="dv">0</span></span>
<span id="cb31-2"><a></a>residuals <span class="op">=</span> Y_train <span class="op">-</span> Y_pred</span>
<span id="cb31-3"><a></a></span>
<span id="cb31-4"><a></a><span class="co"># Construct a pandas data.frame</span></span>
<span id="cb31-5"><a></a>residual_data <span class="op">=</span> pd.DataFrame()</span>
<span id="cb31-6"><a></a>residual_data[<span class="st">"Fitted"</span>] <span class="op">=</span> Y_pred</span>
<span id="cb31-7"><a></a>residual_data[<span class="st">"Residuals"</span>] <span class="op">=</span> residuals</span>
<span id="cb31-8"><a></a>residual_data[<span class="st">"Time"</span>] <span class="op">=</span> residuals.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-13" class="slide level2">
<h2></h2>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div id="fb528ded" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a></a><span class="co"># Residual vs Fitted Values Plot</span></span>
<span id="cb32-2"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb32-3"><a></a>sns.scatterplot(data <span class="op">=</span> residual_data, x <span class="op">=</span> <span class="st">"Fitted"</span>, y <span class="op">=</span> <span class="st">"Residuals"</span>)</span>
<span id="cb32-4"><a></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb32-5"><a></a>plt.xlabel(<span class="st">"Fitted Values (Y_pred)"</span>)</span>
<span id="cb32-6"><a></a>plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb32-7"><a></a>plt.title(<span class="st">"Residuals vs. Fitted Values"</span>)</span>
<span id="cb32-8"><a></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PredictiveModels_files/figure-revealjs/cell-30-output-1.png" class="quarto-figure quarto-figure-center" width="680" height="529"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div id="98b58bee" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb33-2"><a></a>sns.scatterplot(data <span class="op">=</span> residual_data, x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Residuals"</span>)</span>
<span id="cb33-3"><a></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb33-4"><a></a>plt.xlabel(<span class="st">"Time"</span>)</span>
<span id="cb33-5"><a></a>plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb33-6"><a></a>plt.title(<span class="st">"Residuals vs. Time"</span>)</span>
<span id="cb33-7"><a></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PredictiveModels_files/figure-revealjs/cell-31-output-1.png" class="quarto-figure quarto-figure-center" width="682" height="529"></p>
</figure>
</div>
</div>
</div>
</div></div>
</div>
</section>
<section id="the-model-is-more-flexible-than-that" class="slide level2">
<h2>The model is more flexible than that</h2>
<p><br></p>
<p>If necessary, the linear regression model can be extended to capture quadratic relationships. For this, the model takes the following form:</p>
<p><span class="math display">\[\hat{Y}_i = \hat{\beta}_0 + \hat{\beta}_1 T_i + \hat{\beta}_2 T^{2}_i \]</span></p>
<ul>
<li><p>Where <span class="math inline">\(T^{2}_i\)</span> is the squared value of the time index.</p></li>
<li><p><span class="math inline">\(\hat{\beta}_2\)</span> is a term that captures possible curvature in the time series.</p></li>
</ul>
</section>
<section id="in-python-2" class="slide level2">
<h2>In Python</h2>
<p>To include a quadratic term, we must augment our predictor matrix with an additional column. The following code shows how to augment <code>X_full</code> by the square of the <code>Amtrak_data['t']</code> column. This is done using the <strong>pandas</strong> <code>.concat()</code> function. The resulting matrix is stored in <code>X_quad</code>.</p>
<div id="e50b1c02" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a></a>X_quad <span class="op">=</span> pd.concat([X_train, Amtrak_train[<span class="st">'t'</span>]<span class="op">**</span><span class="dv">2</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we follow the same steps to fit this model.</p>
<div id="7223e420" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a></a><span class="co"># 1. Create linear regression model</span></span>
<span id="cb35-2"><a></a>QuadmodelAmtrak <span class="op">=</span> LinearRegression()</span>
<span id="cb35-3"><a></a></span>
<span id="cb35-4"><a></a><span class="co"># 2. Fit linear regression model</span></span>
<span id="cb35-5"><a></a>QuadmodelAmtrak.fit(X_quad, Y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-14" class="slide level2">
<h2></h2>
<p><br></p>
<p>We show the estimated coefficients in Python.</p>
<div id="98dacb1a" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a></a><span class="bu">print</span>(<span class="st">"Intercept = "</span>, QuadmodelAmtrak.intercept_)</span>
<span id="cb36-2"><a></a><span class="bu">print</span>(<span class="st">"Coefficients = "</span>, QuadmodelAmtrak.coef_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercept =  [1866.84019635]
Coefficients =  [[-4.64563238  0.03397778]]</code></pre>
</div>
</div>
<p><br></p>
<p>The estimated model thus is</p>
<p><span class="math display">\[\hat{Y}_i = 1866.84 - 4.65 T_i + 0.03 T^2_i.\]</span></p>
</section>
<section id="residual-analysis-1" class="slide level2">
<h2>Residual analysis</h2>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div id="537bc1d1" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a></a><span class="co"># Remember to use the same `X_quad`</span></span>
<span id="cb38-2"><a></a>Y_pred_quad <span class="op">=</span> QuadmodelAmtrak.predict(X_quad) <span class="op">+</span> Y_train<span class="op">*</span><span class="dv">0</span></span>
<span id="cb38-3"><a></a>residuals_quad <span class="op">=</span> Y_train <span class="op">-</span> Y_pred_quad</span>
<span id="cb38-4"><a></a><span class="co"># Construct a pandas data.frame</span></span>
<span id="cb38-5"><a></a>residual_data_quad <span class="op">=</span> pd.DataFrame()</span>
<span id="cb38-6"><a></a>residual_data_quad[<span class="st">"Fitted"</span>] <span class="op">=</span> Y_pred_quad</span>
<span id="cb38-7"><a></a>residual_data_quad[<span class="st">"Residuals"</span>] <span class="op">=</span> residuals_quad</span>
<span id="cb38-8"><a></a>residual_data_quad[<span class="st">"Time"</span>] <span class="op">=</span> residuals_quad.index</span>
<span id="cb38-9"><a></a></span>
<span id="cb38-10"><a></a></span>
<span id="cb38-11"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb38-12"><a></a>sns.scatterplot(data <span class="op">=</span> residual_data_quad, x <span class="op">=</span> <span class="st">"Fitted"</span>, y <span class="op">=</span> <span class="st">"Residuals"</span>)</span>
<span id="cb38-13"><a></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb38-14"><a></a>plt.xlabel(<span class="st">"Fitted Values (Y_pred_quad)"</span>)</span>
<span id="cb38-15"><a></a>plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb38-16"><a></a>plt.title(<span class="st">"Residuals vs. Fitted Values"</span>)</span>
<span id="cb38-17"><a></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PredictiveModels_files/figure-revealjs/cell-35-output-1.png" class="quarto-figure quarto-figure-center" width="680" height="529"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div id="5b7e03fe" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb39-2"><a></a>sns.scatterplot(data <span class="op">=</span> residual_data_quad, x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Residuals"</span>)</span>
<span id="cb39-3"><a></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb39-4"><a></a>plt.xlabel(<span class="st">"Time (t)"</span>)</span>
<span id="cb39-5"><a></a>plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb39-6"><a></a>plt.title(<span class="st">"Residuals vs. Time"</span>)</span>
<span id="cb39-7"><a></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PredictiveModels_files/figure-revealjs/cell-36-output-1.png" class="quarto-figure quarto-figure-center" width="682" height="529"></p>
</figure>
</div>
</div>
</div>
</div></div>
</div>
</section>
<section id="model-evaluation-using-validation-data" class="slide level2">
<h2>Model evaluation using validation data</h2>
<p><br></p>
<p>Remember that another way to evaluate the performance of a model is using the <span class="math inline">\(\text{MSE}_v\)</span> or <span class="math inline">\(\text{RMSE}_v\)</span> on the validation data. To this end, we need some Python objects.</p>
<div id="44504fb2" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a></a><span class="co"># Set predictor.</span></span>
<span id="cb40-2"><a></a>X_valid <span class="op">=</span> Amtrak_validation.<span class="bu">filter</span>([<span class="st">'t'</span>])</span>
<span id="cb40-3"><a></a></span>
<span id="cb40-4"><a></a><span class="co"># Set response.</span></span>
<span id="cb40-5"><a></a>Y_valid <span class="op">=</span> Amtrak_validation.<span class="bu">filter</span>([<span class="st">'Ridership (in 000s)'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-15" class="slide level2">
<h2></h2>
<p>Let’s compute the <span class="math inline">\(\text{MSE}_v\)</span> for the linear regression model.</p>
<div id="dea66862" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a></a>Y_val_pred_lin <span class="op">=</span> LRmodelAmtrak.predict(X_valid)</span>
<span id="cb41-2"><a></a>mse <span class="op">=</span> mean_squared_error(Y_valid, Y_val_pred_lin)  </span>
<span id="cb41-3"><a></a><span class="bu">print</span>(<span class="bu">round</span>(mse, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>62517.47</code></pre>
</div>
</div>
<p>Let’s do the same for the the linear regression model with a quadratic term.</p>
<div id="d8792922" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a></a>X_quad_valid <span class="op">=</span> pd.concat([X_valid, Amtrak_validation[<span class="st">'t'</span>]<span class="op">**</span><span class="dv">2</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb43-2"><a></a>Y_val_pred_quad <span class="op">=</span> QuadmodelAmtrak.predict(X_quad_valid)</span>
<span id="cb43-3"><a></a>mse_quad <span class="op">=</span> mean_squared_error(Y_valid, Y_val_pred_quad)  <span class="co"># Mean Squared Error (MSE)</span></span>
<span id="cb43-4"><a></a><span class="bu">print</span>(<span class="bu">round</span>(mse_quad, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>30271.15</code></pre>
</div>
</div>
<p>We conclude that the linear model with a quadratic term is better than the linear regression model because the <span class="math inline">\(\text{MSE}_v\)</span> of the former is smaller than for the latter.</p>
</section>
<section id="mini-activity-cooperative-mode-1" class="slide level2">
<h2>Mini-Activity (<em>cooperative</em> mode)</h2>
<ol type="1">
<li><p>Consider the dataset <em>CanadianWorkHours.xlsx</em> in Canvas.</p></li>
<li><p>Split the data into training and validation</p></li>
<li><p>Visualize the series in Python. The response variable is Working Hours and the predictor is Year.</p></li>
<li><p>Using Python, answer the question: Which of the following models best fits the series?</p></li>
</ol>
<ul>
<li><p>Linear trend regression model.</p></li>
<li><p>Quadratic trend regression model.</p></li>
</ul>
</section>
<section id="identifying-heteroskedasticity" class="slide level2">
<h2>Identifying Heteroskedasticity</h2>
<p><br><br></p>
<p>Heteroskedasticity arises when the dispersion of model errors is not constant over time.</p>
<p>To see it, let’s go back to the Airline data, which contains the number of passengers of an international airline per month between 1949 and 1960.</p>
<div id="be267c03" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a></a>Airline_data <span class="op">=</span> pd.read_excel(<span class="st">"Airline.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-16" class="slide level2">
<h2></h2>
<p><br><br></p>
<div id="fd1b59c9" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a></a>Airline_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">T</th>
<th data-quarto-table-cell-role="th">Number of passengers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>112</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>118</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>132</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>129</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>121</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="section-17" class="slide level2">
<h2></h2>
<p>For illustrative purposes, we will not split the time series into training and validation datasets.</p>
<div id="7aa4b521" class="cell" data-execution_count="41">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb47-2"><a></a>sns.lineplot(x<span class="op">=</span><span class="st">'T'</span>, y<span class="op">=</span><span class="st">'Number of passengers'</span>, data <span class="op">=</span> Airline_data)</span>
<span id="cb47-3"><a></a>plt.xlabel(<span class="st">'Time'</span>)</span>
<span id="cb47-4"><a></a>plt.ylabel(<span class="st">'Number of passengers'</span>)</span>
<span id="cb47-5"><a></a>plt.title(<span class="st">'Number of passengers across time'</span>)</span>
<span id="cb47-6"><a></a>plt.tight_layout()</span>
<span id="cb47-7"><a></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PredictiveModels_files/figure-revealjs/cell-42-output-1.png" class="quarto-figure quarto-figure-center" width="944" height="464"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="section-18" class="slide level2">
<h2></h2>
<p><br><br></p>
<p>Let’s fit a linear regression model.</p>
<div id="71705c36" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a></a><span class="co"># Set predictor.</span></span>
<span id="cb48-2"><a></a>X_full <span class="op">=</span> Airline_data.<span class="bu">filter</span>([<span class="st">'T'</span>])</span>
<span id="cb48-3"><a></a></span>
<span id="cb48-4"><a></a><span class="co"># Set response.</span></span>
<span id="cb48-5"><a></a>Y_full <span class="op">=</span> Airline_data.<span class="bu">filter</span>([<span class="st">'Number of passengers'</span>])</span>
<span id="cb48-6"><a></a></span>
<span id="cb48-7"><a></a><span class="co"># 1. Create linear regression</span></span>
<span id="cb48-8"><a></a>LRmodelAirline <span class="op">=</span> LinearRegression()</span>
<span id="cb48-9"><a></a></span>
<span id="cb48-10"><a></a><span class="co"># 2. Fit the model</span></span>
<span id="cb48-11"><a></a>LRmodelAirline.fit(X_full, Y_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="residual-analysis-2" class="slide level2">
<h2>Residual analysis</h2>
<div style="font-size: 90%;">
<p><strong>Heteroskedasticity</strong>: Dispersion of the residuals increases with the predicted value.</p>
</div>
<div id="aa503df3" class="cell" data-execution_count="43">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a></a><span class="co"># Remember to use the same `X_quad`</span></span>
<span id="cb49-2"><a></a>Y_pred <span class="op">=</span> LRmodelAirline.predict(X_full) <span class="op">+</span> Y_full<span class="op">*</span><span class="dv">0</span></span>
<span id="cb49-3"><a></a>residuals <span class="op">=</span> Y_full <span class="op">-</span> Y_pred</span>
<span id="cb49-4"><a></a></span>
<span id="cb49-5"><a></a><span class="co"># Construct a pandas data.frame</span></span>
<span id="cb49-6"><a></a>residual_data <span class="op">=</span> pd.DataFrame()</span>
<span id="cb49-7"><a></a>residual_data[<span class="st">"Fitted"</span>] <span class="op">=</span> Y_pred</span>
<span id="cb49-8"><a></a>residual_data[<span class="st">"Residuals"</span>] <span class="op">=</span> residuals</span>
<span id="cb49-9"><a></a>residual_data[<span class="st">"Time"</span>] <span class="op">=</span> residuals.index</span>
<span id="cb49-10"><a></a></span>
<span id="cb49-11"><a></a></span>
<span id="cb49-12"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb49-13"><a></a>sns.scatterplot(data <span class="op">=</span> residual_data, x <span class="op">=</span> <span class="st">"Fitted"</span>, y <span class="op">=</span> <span class="st">"Residuals"</span>)</span>
<span id="cb49-14"><a></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb49-15"><a></a>plt.xlabel(<span class="st">"Fitted Values (Y_pred_quad)"</span>)</span>
<span id="cb49-16"><a></a>plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb49-17"><a></a>plt.title(<span class="st">"Residuals vs. Fitted Values"</span>)</span>
<span id="cb49-18"><a></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PredictiveModels_files/figure-revealjs/cell-44-output-1.png" class="quarto-figure quarto-figure-center" width="531" height="381"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="solution" class="slide level2">
<h2>Solution</h2>
<p><br></p>
<p>If we identify heteroskedasticity in the regression model errors, we have several transformation options for our <strong>original</strong> series.</p>
<ul>
<li><p>A common transformations to the time series <span class="math inline">\(Y_i\)</span> is the <strong>Natural Logarithm</strong></p></li>
<li><p>If the original time series contains negative values, it can be <strong>lagged</strong> by adding the negative of its minimum value.</p></li>
</ul>
</section>
<section id="in-python-3" class="slide level2">
<h2>In Python</h2>
<p>The easiest way to apply the logarithm in Python is to use the <code>log()</code> function from the <strong>numpy</strong> library</p>
<div id="e85a17bf" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a></a>log_Y_full <span class="op">=</span> np.log( Y_full )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, the response to use is in <code>log_Y_full</code>.</p>
<p><br></p>
<p>The steps to fit a linear regression model are similar.</p>
<div id="3de67b7b" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a></a><span class="co"># 1. Create linear regression</span></span>
<span id="cb51-2"><a></a>LRmodelAirlineTransformed <span class="op">=</span> LinearRegression()</span>
<span id="cb51-3"><a></a></span>
<span id="cb51-4"><a></a><span class="co"># 2. Fit the model</span></span>
<span id="cb51-5"><a></a>LRmodelAirlineTransformed.fit(X_full, log_Y_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="residual-analysis-3" class="slide level2">
<h2>Residual analysis</h2>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<p>With transformation</p>
<div id="9733829f" class="cell" data-execution_count="46">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a></a><span class="co"># Remember to use the same `X_quad`</span></span>
<span id="cb52-2"><a></a>Y_pred_log <span class="op">=</span> LRmodelAirlineTransformed.predict(X_full) <span class="op">+</span> log_Y_full<span class="op">*</span><span class="dv">0</span></span>
<span id="cb52-3"><a></a>residuals_log <span class="op">=</span> log_Y_full <span class="op">-</span> Y_pred_log</span>
<span id="cb52-4"><a></a></span>
<span id="cb52-5"><a></a><span class="co"># Construct a pandas data.frame</span></span>
<span id="cb52-6"><a></a>residual_data_log <span class="op">=</span> pd.DataFrame()</span>
<span id="cb52-7"><a></a>residual_data_log[<span class="st">"Fitted"</span>] <span class="op">=</span> Y_pred_log</span>
<span id="cb52-8"><a></a>residual_data_log[<span class="st">"Residuals"</span>] <span class="op">=</span> residuals_log</span>
<span id="cb52-9"><a></a>residual_data_log[<span class="st">"Time"</span>] <span class="op">=</span> residuals_log.index</span>
<span id="cb52-10"><a></a></span>
<span id="cb52-11"><a></a></span>
<span id="cb52-12"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb52-13"><a></a>sns.scatterplot(data <span class="op">=</span> residual_data_log, x <span class="op">=</span> <span class="st">"Fitted"</span>, y <span class="op">=</span> <span class="st">"Residuals"</span>)</span>
<span id="cb52-14"><a></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb52-15"><a></a>plt.xlabel(<span class="st">"Fitted Values (Y_pred_quad)"</span>)</span>
<span id="cb52-16"><a></a>plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb52-17"><a></a>plt.title(<span class="st">"Residuals vs. Fitted Values"</span>)</span>
<span id="cb52-18"><a></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PredictiveModels_files/figure-revealjs/cell-47-output-1.png" class="quarto-figure quarto-figure-center" width="527" height="381"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>Without transformation</p>
<div id="0c810218" class="cell" data-execution_count="47">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a></a><span class="co"># Remember to use the same `X_quad`</span></span>
<span id="cb53-2"><a></a>Y_pred <span class="op">=</span> LRmodelAirline.predict(X_full) <span class="op">+</span> Y_full<span class="op">*</span><span class="dv">0</span></span>
<span id="cb53-3"><a></a>residuals <span class="op">=</span> Y_full <span class="op">-</span> Y_pred</span>
<span id="cb53-4"><a></a></span>
<span id="cb53-5"><a></a><span class="co"># Construct a pandas data.frame</span></span>
<span id="cb53-6"><a></a>residual_data <span class="op">=</span> pd.DataFrame()</span>
<span id="cb53-7"><a></a>residual_data[<span class="st">"Fitted"</span>] <span class="op">=</span> Y_pred</span>
<span id="cb53-8"><a></a>residual_data[<span class="st">"Residuals"</span>] <span class="op">=</span> residuals</span>
<span id="cb53-9"><a></a>residual_data[<span class="st">"Time"</span>] <span class="op">=</span> residuals.index</span>
<span id="cb53-10"><a></a></span>
<span id="cb53-11"><a></a></span>
<span id="cb53-12"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb53-13"><a></a>sns.scatterplot(data <span class="op">=</span> residual_data, x <span class="op">=</span> <span class="st">"Fitted"</span>, y <span class="op">=</span> <span class="st">"Residuals"</span>)</span>
<span id="cb53-14"><a></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb53-15"><a></a>plt.xlabel(<span class="st">"Fitted Values (Y_pred_quad)"</span>)</span>
<span id="cb53-16"><a></a>plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb53-17"><a></a>plt.title(<span class="st">"Residuals vs. Fitted Values"</span>)</span>
<span id="cb53-18"><a></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PredictiveModels_files/figure-revealjs/cell-48-output-1.png" class="quarto-figure quarto-figure-center" width="531" height="381"></p>
</figure>
</div>
</div>
</div>
</div></div>
</div>
</section>
<section id="what-do-i-do-if-the-transformation-doesnt-work" class="slide level2">
<h2>What do I do if the transformation doesn’t work?</h2>
<p><br></p>
<ul>
<li><p>If the log transformation doesn’t significantly reduce heteroskedasticity, there are models for modeling variance called GARCH.</p></li>
<li><p>You can find literature on these models and their software implementations in a time series textbook such as <em>Time Series Analysis with Applications in R</em> by Cryer and Chan.</p></li>
</ul>
</section>
<section id="seasonality" class="slide level2">
<h2>Seasonality</h2>
<p>Seasonality refers to repetitive or cyclical behavior that occurs with a constant frequency.</p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<p>Examples:</p>
<ul>
<li><p>Demand for winter clothing</p></li>
<li><p>Demand for tourist travel</p></li>
<li><p>Amount of rainfall throughout the year.</p></li>
</ul>
</div><div class="column" style="width:50%;">
<div id="4af639b8" class="cell" data-execution_count="48">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PredictiveModels_files/figure-revealjs/cell-49-output-1.png" class="quarto-figure quarto-figure-center" width="464" height="464"></p>
</figure>
</div>
</div>
</div>
</div></div>
</div>
</section>
<section id="capturing-seasonality" class="slide level2">
<h2>Capturing seasonality</h2>
<div class="center">
<div class="columns">
<div class="column" style="width:60%;">
<p>The linear regression model can be extended to capture seasonal patterns in the time series.</p>
<p>To do this, an additional categorical predictor is created that indicates the season to which each data item belongs.</p>
<p>Behind the scenes, the additional categorical predictor is transformed into several auxiliary numerical predictors.</p>
</div><div class="column" style="width:40%;">
<p><br></p>
<p><img data-src="images/clipboard-2320382344.png"></p>
</div></div>
</div>
</section>
<section id="analyzing-seasonal-series-in-python" class="slide level2">
<h2>Analyzing seasonal series in Python</h2>
<p>Consider the data in <code>Amtrak_train</code> with the additional predictor of <code>Season</code> to model seasonality.</p>
<div id="c7603ddf" class="cell" data-execution_count="49">
<div class="cell-output cell-output-display" data-execution_count="49">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Month</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">Ridership (in 000s)</th>
<th data-quarto-table-cell-role="th">Season</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1991-01-01</td>
<td>1</td>
<td>1708.917</td>
<td>Jan</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1991-02-01</td>
<td>2</td>
<td>1620.586</td>
<td>Feb</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1991-03-04</td>
<td>3</td>
<td>1972.715</td>
<td>Mar</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1991-04-04</td>
<td>4</td>
<td>1811.665</td>
<td>Apr</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1991-05-05</td>
<td>5</td>
<td>1974.964</td>
<td>May</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="section-19" class="slide level2">
<h2></h2>
<p>To fit a linear regression model with a categorical variable like <code>Season</code>, we must transform the text categories into numbers. To do this, we use dummy variables constructed using the following commands.</p>
<div id="cda5a34e" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a></a>dummy_data <span class="op">=</span> pd.get_dummies(Amtrak_train[<span class="st">'Season'</span>], dtype <span class="op">=</span> <span class="st">'int'</span>)</span>
<span id="cb54-2"><a></a>dummy_data.head(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Apr</th>
<th data-quarto-table-cell-role="th">Aug</th>
<th data-quarto-table-cell-role="th">Dec</th>
<th data-quarto-table-cell-role="th">Feb</th>
<th data-quarto-table-cell-role="th">Jan</th>
<th data-quarto-table-cell-role="th">Jul</th>
<th data-quarto-table-cell-role="th">Jun</th>
<th data-quarto-table-cell-role="th">Mar</th>
<th data-quarto-table-cell-role="th">May</th>
<th data-quarto-table-cell-role="th">Nov</th>
<th data-quarto-table-cell-role="th">Oct</th>
<th data-quarto-table-cell-role="th">Sep</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="section-20" class="slide level2">
<h2></h2>
<p>Simply put, the matrix above contains one column for each month. Each column indicates the observations that belong to the month of the column. For example, the column <code>Apr</code> has the values 0 and 1. The value 1 indicates that the corresponding observation belongs to the month of April. A 0 indicates otherwise.</p>
<div id="41f7401e" class="cell" data-execution_count="51">
<div class="cell-output cell-output-display" data-execution_count="51">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Apr</th>
<th data-quarto-table-cell-role="th">Aug</th>
<th data-quarto-table-cell-role="th">Dec</th>
<th data-quarto-table-cell-role="th">Feb</th>
<th data-quarto-table-cell-role="th">Jan</th>
<th data-quarto-table-cell-role="th">Jul</th>
<th data-quarto-table-cell-role="th">Jun</th>
<th data-quarto-table-cell-role="th">Mar</th>
<th data-quarto-table-cell-role="th">May</th>
<th data-quarto-table-cell-role="th">Nov</th>
<th data-quarto-table-cell-role="th">Oct</th>
<th data-quarto-table-cell-role="th">Sep</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="section-21" class="slide level2">
<h2></h2>
<p><br></p>
<p>Unfortunately, we cannot use the matrix as is in the linear regression model. This is due to multicollinearity issues. Technically, this happens because if you add all the columns, the resulting column is a column of 1s, which is already used by the intercept. Therefore, you cannot fit a model with the intercept and all the columns of the dummy variables.</p>
<p><br></p>
<p>To solve this problem, we arbitrarily remove a column from the matrix above. For example, let’s remove <code>Dec</code>.</p>
<div id="dacbfe14" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a></a>dummy_data <span class="op">=</span> dummy_data.drop([<span class="st">"Dec"</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-22" class="slide level2">
<h2></h2>
<p>Now, let’s build the complete matrix of predictors, including the column for time, time squared, and the dummy variables.</p>
<div id="15b8d0ea" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a></a>X_quad_season <span class="op">=</span> pd.concat([Amtrak_train[<span class="st">'t'</span>], Amtrak_train[<span class="st">'t'</span>]<span class="op">**</span><span class="dv">2</span>, dummy_data], </span>
<span id="cb56-2"><a></a>                          axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Next, we fit the model with all the terms in the matrix above.</p>
<div id="53a704ac" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a></a><span class="co"># 0. Ensure that we have the response in `Y_full`.</span></span>
<span id="cb57-2"><a></a>Y_train <span class="op">=</span> Amtrak_train[<span class="st">'Ridership (in 000s)'</span>]</span>
<span id="cb57-3"><a></a></span>
<span id="cb57-4"><a></a><span class="co"># 1. Create linear regression model.</span></span>
<span id="cb57-5"><a></a>SeasonmodelAmtrak <span class="op">=</span> LinearRegression()</span>
<span id="cb57-6"><a></a></span>
<span id="cb57-7"><a></a><span class="co"># 2. Fit the linear regression model.</span></span>
<span id="cb57-8"><a></a>SeasonmodelAmtrak.fit(X_quad_season, Y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="estimated-model-coefficients" class="slide level2">
<h2>Estimated model coefficients</h2>
<p><br></p>
<div id="a26d6d19" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a></a><span class="bu">print</span>(<span class="st">"Intercept = "</span>, SeasonmodelAmtrak.intercept_)</span>
<span id="cb58-2"><a></a><span class="bu">print</span>(<span class="st">"Coefficients = "</span>, SeasonmodelAmtrak.coef_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercept =  1924.3205889003025
Coefficients =  [-6.12171259e+00  4.96085283e-02  1.22309969e+01  1.77720172e+02
 -2.83088245e+02 -2.25659158e+02  1.15685204e+02 -7.31735621e+00
  1.59876604e+01  5.17037414e+01 -4.77796001e+01 -3.19949172e+01
 -1.45366826e+02]</code></pre>
</div>
</div>
</section>
<section id="residual-analysis-4" class="slide level2">
<h2>Residual analysis</h2>
<div id="a9db0459" class="cell" data-execution_count="56">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a></a>Y_pred <span class="op">=</span> SeasonmodelAmtrak.predict(X_quad_season)</span>
<span id="cb60-2"><a></a>residuals <span class="op">=</span> Y_train <span class="op">-</span> Y_pred</span>
<span id="cb60-3"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb60-4"><a></a>sns.scatterplot(x<span class="op">=</span>Amtrak_data[<span class="st">'t'</span>], y<span class="op">=</span>residuals)</span>
<span id="cb60-5"><a></a>plt.xlabel(<span class="st">"Time (t)"</span>)</span>
<span id="cb60-6"><a></a>plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb60-7"><a></a>plt.title(<span class="st">"Residuals vs. Time"</span>)</span>
<span id="cb60-8"><a></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="PredictiveModels_files/figure-revealjs/cell-57-output-1.png" class="quarto-figure quarto-figure-center" width="680" height="529"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="predictions-on-the-validation-dataset" class="slide level2">
<h2>Predictions on the validation dataset</h2>
<p>Prepare the validation data using dummy variables.</p>
<div id="0453922e" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a></a>Y_valid <span class="op">=</span> Amtrak_validation[<span class="st">'Ridership (in 000s)'</span>]</span>
<span id="cb61-2"><a></a></span>
<span id="cb61-3"><a></a>dummy_valid <span class="op">=</span> pd.get_dummies(Amtrak_validation[<span class="st">'Season'</span>], dtype <span class="op">=</span> <span class="st">'int'</span>)</span>
<span id="cb61-4"><a></a>dummy_valid <span class="op">=</span> dummy_valid.drop([<span class="st">"Dec"</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb61-5"><a></a></span>
<span id="cb61-6"><a></a>X_qs_valid <span class="op">=</span> pd.concat([Amtrak_validation[<span class="st">'t'</span>], Amtrak_validation[<span class="st">'t'</span>]<span class="op">**</span><span class="dv">2</span>, </span>
<span id="cb61-7"><a></a>                        dummy_valid], axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Now, we compute the validation <span class="math inline">\(\text{MSE}_v\)</span>.</p>
<div id="91077e9b" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a></a>Y_pred_valid <span class="op">=</span> SeasonmodelAmtrak.predict(X_qs_valid)</span>
<span id="cb62-2"><a></a></span>
<span id="cb62-3"><a></a>mse_season <span class="op">=</span> mean_squared_error(Y_valid, Y_pred_valid) </span>
<span id="cb62-4"><a></a><span class="bu">print</span>(<span class="bu">round</span>(mse_season, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4890.5</code></pre>
</div>
</div>
</section>
<section id="disadvantages-of-linear-regression" class="slide level2">
<h2>Disadvantages of linear regression</h2>
<ul>
<li><p>Despite their simplicity and versatility, linear regression models are not the best for describing a time series.</p></li>
<li><p>This is because they do not assume a dependency between consecutive values in the time series. That is, they do not use the fact that, for example, <span class="math inline">\(Y_1\)</span> can help us predict <span class="math inline">\(Y_2\)</span>, and <span class="math inline">\(Y_2\)</span> can help us predict <span class="math inline">\(Y_3\)</span>, etc.</p></li>
<li><p>Models that help us use past observations to predict future values of the response variable <span class="math inline">\(Y\)</span> are <strong>autoregressive models</strong>.</p></li>
</ul>
</section>
<section id="yogi-berra" class="slide level2">
<h2>Yogi Berra</h2>
<p><br><br><br></p>
<blockquote>
<p>It’s though to make predictions, especially about the future.</p>
</blockquote>
</section></section>
<section id="return-to-main-page" class="title-slide slide level1 center">
<h1><a href="https://alanrvazquez.github.io/TEC-IN2004B/">Return to main page</a></h1>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="IN2004B_logo.png" class="slide-logo"></p>
<div class="footer footer-default">
<p>Tecnologico de Monterrey</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>