<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alan R. Vazquez">

<title>Introduction to Time Series – IN2004B Generation of Value with Data Analytics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-79108a0fc1995748cbd19a5b0e3e3e7c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      IN2004B Generation of Value with Data Analytics
      </li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">IN2004B Generation of Value with Data Analytics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#agenda" id="toc-agenda" class="nav-link active" data-scroll-target="#agenda">Agenda</a></li>
  <li><a href="#time-series" id="toc-time-series" class="nav-link" data-scroll-target="#time-series">Time Series</a>
  <ul class="collapse">
  <li><a href="#load-the-libraries" id="toc-load-the-libraries" class="nav-link" data-scroll-target="#load-the-libraries">Load the libraries</a></li>
  <li><a href="#what-is-a-time-series" id="toc-what-is-a-time-series" class="nav-link" data-scroll-target="#what-is-a-time-series">What is a time series?</a></li>
  <li><a href="#example-1-teslas-stock-price" id="toc-example-1-teslas-stock-price" class="nav-link" data-scroll-target="#example-1-teslas-stock-price">Example 1: Tesla’s stock price</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#example-2-amtrak-data" id="toc-example-2-amtrak-data" class="nav-link" data-scroll-target="#example-2-amtrak-data">Example 2: Amtrak data</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"></a></li>
  <li><a href="#time-series-plot-in-python" id="toc-time-series-plot-in-python" class="nav-link" data-scroll-target="#time-series-plot-in-python">Time series plot in Python</a></li>
  <li><a href="#informative-series" id="toc-informative-series" class="nav-link" data-scroll-target="#informative-series">Informative Series</a></li>
  <li><a href="#example-3-airline-data" id="toc-example-3-airline-data" class="nav-link" data-scroll-target="#example-3-airline-data">Example 3: Airline data</a></li>
  <li><a href="#non-informative-series-white-noise" id="toc-non-informative-series-white-noise" class="nav-link" data-scroll-target="#non-informative-series-white-noise">Non-informative series: White noise</a></li>
  </ul></li>
  <li><a href="#linear-regression-model-for-time-series" id="toc-linear-regression-model-for-time-series" class="nav-link" data-scroll-target="#linear-regression-model-for-time-series">Linear Regression Model for Time Series</a>
  <ul class="collapse">
  <li><a href="#linear-regression-model" id="toc-linear-regression-model" class="nav-link" data-scroll-target="#linear-regression-model">Linear regression model</a></li>
  <li><a href="#trend" id="toc-trend" class="nav-link" data-scroll-target="#trend">Trend</a></li>
  <li><a href="#model-evaluation" id="toc-model-evaluation" class="nav-link" data-scroll-target="#model-evaluation">Model evaluation</a></li>
  <li><a href="#example-2-amtrak-data-cont." id="toc-example-2-amtrak-data-cont." class="nav-link" data-scroll-target="#example-2-amtrak-data-cont.">Example 2: Amtrak data (cont.)</a></li>
  <li><a href="#creating-a-train-and-a-validation-data" id="toc-creating-a-train-and-a-validation-data" class="nav-link" data-scroll-target="#creating-a-train-and-a-validation-data">Creating a train and a validation data</a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"></a></li>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3"></a></li>
  <li><a href="#fit-linear-regression-model" id="toc-fit-linear-regression-model" class="nav-link" data-scroll-target="#fit-linear-regression-model">Fit linear regression model</a></li>
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4"></a></li>
  <li><a href="#residual-analysis" id="toc-residual-analysis" class="nav-link" data-scroll-target="#residual-analysis">Residual analysis</a></li>
  <li><a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5"></a></li>
  <li><a href="#the-model-is-more-flexible-than-that" id="toc-the-model-is-more-flexible-than-that" class="nav-link" data-scroll-target="#the-model-is-more-flexible-than-that">The model is more flexible than that</a></li>
  <li><a href="#in-python" id="toc-in-python" class="nav-link" data-scroll-target="#in-python">In Python</a></li>
  <li><a href="#section-6" id="toc-section-6" class="nav-link" data-scroll-target="#section-6"></a></li>
  <li><a href="#residual-analysis-1" id="toc-residual-analysis-1" class="nav-link" data-scroll-target="#residual-analysis-1">Residual analysis</a></li>
  <li><a href="#model-evaluation-using-validation-data" id="toc-model-evaluation-using-validation-data" class="nav-link" data-scroll-target="#model-evaluation-using-validation-data">Model evaluation using validation data</a></li>
  <li><a href="#section-7" id="toc-section-7" class="nav-link" data-scroll-target="#section-7"></a></li>
  <li><a href="#section-8" id="toc-section-8" class="nav-link" data-scroll-target="#section-8"></a></li>
  <li><a href="#section-9" id="toc-section-9" class="nav-link" data-scroll-target="#section-9"></a></li>
  <li><a href="#activity-solo-mode" id="toc-activity-solo-mode" class="nav-link" data-scroll-target="#activity-solo-mode">Activity (<em>solo</em> mode)</a></li>
  <li><a href="#identifying-heteroskedasticity" id="toc-identifying-heteroskedasticity" class="nav-link" data-scroll-target="#identifying-heteroskedasticity">Identifying Heteroskedasticity</a></li>
  <li><a href="#section-10" id="toc-section-10" class="nav-link" data-scroll-target="#section-10"></a></li>
  <li><a href="#section-11" id="toc-section-11" class="nav-link" data-scroll-target="#section-11"></a></li>
  <li><a href="#section-12" id="toc-section-12" class="nav-link" data-scroll-target="#section-12"></a></li>
  <li><a href="#residual-analysis-2" id="toc-residual-analysis-2" class="nav-link" data-scroll-target="#residual-analysis-2">Residual analysis</a></li>
  <li><a href="#solution" id="toc-solution" class="nav-link" data-scroll-target="#solution">Solution</a></li>
  <li><a href="#in-python-1" id="toc-in-python-1" class="nav-link" data-scroll-target="#in-python-1">In Python</a></li>
  <li><a href="#residual-analysis-3" id="toc-residual-analysis-3" class="nav-link" data-scroll-target="#residual-analysis-3">Residual analysis</a></li>
  <li><a href="#what-do-i-do-if-the-transformation-doesnt-work" id="toc-what-do-i-do-if-the-transformation-doesnt-work" class="nav-link" data-scroll-target="#what-do-i-do-if-the-transformation-doesnt-work">What do I do if the transformation doesn’t work?</a></li>
  </ul></li>
  <li><a href="#models-with-seasonality" id="toc-models-with-seasonality" class="nav-link" data-scroll-target="#models-with-seasonality">Models with Seasonality</a>
  <ul class="collapse">
  <li><a href="#seasonality" id="toc-seasonality" class="nav-link" data-scroll-target="#seasonality">Seasonality</a></li>
  <li><a href="#capturing-seasonality" id="toc-capturing-seasonality" class="nav-link" data-scroll-target="#capturing-seasonality">Capturing seasonality</a></li>
  <li><a href="#analyzing-seasonal-series-in-python" id="toc-analyzing-seasonal-series-in-python" class="nav-link" data-scroll-target="#analyzing-seasonal-series-in-python">Analyzing seasonal series in Python</a></li>
  <li><a href="#section-13" id="toc-section-13" class="nav-link" data-scroll-target="#section-13"></a></li>
  <li><a href="#section-14" id="toc-section-14" class="nav-link" data-scroll-target="#section-14"></a></li>
  <li><a href="#section-15" id="toc-section-15" class="nav-link" data-scroll-target="#section-15"></a></li>
  <li><a href="#section-16" id="toc-section-16" class="nav-link" data-scroll-target="#section-16"></a></li>
  <li><a href="#estimated-model-coefficients" id="toc-estimated-model-coefficients" class="nav-link" data-scroll-target="#estimated-model-coefficients">Estimated model coefficients</a></li>
  <li><a href="#residual-analysis-4" id="toc-residual-analysis-4" class="nav-link" data-scroll-target="#residual-analysis-4">Residual analysis</a></li>
  <li><a href="#predictions-on-the-validation-dataset" id="toc-predictions-on-the-validation-dataset" class="nav-link" data-scroll-target="#predictions-on-the-validation-dataset">Predictions on the validation dataset</a></li>
  <li><a href="#section-17" id="toc-section-17" class="nav-link" data-scroll-target="#section-17"></a></li>
  <li><a href="#disadvantages-of-linear-regression" id="toc-disadvantages-of-linear-regression" class="nav-link" data-scroll-target="#disadvantages-of-linear-regression">Disadvantages of linear regression</a></li>
  <li><a href="#yogi-berra" id="toc-yogi-berra" class="nav-link" data-scroll-target="#yogi-berra">Yogi Berra</a></li>
  </ul></li>
  <li><a href="#return-to-main-page" id="toc-return-to-main-page" class="nav-link" data-scroll-target="#return-to-main-page">Return to main page</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="TimeSeries.slides.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction to Time Series</h1>
<p class="subtitle lead">IN2004B: Generation of Value with Data Analytics</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Alan R. Vazquez </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Department of Industrial Engineering
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<section id="agenda" class="level3">
<h3 class="anchored" data-anchor-id="agenda">Agenda</h3>
<p><br></p>
<ol type="1">
<li>Time Series</li>
<li>Linear Regression Model for Time Series</li>
<li>Models with Seasonality</li>
</ol>
</section>
<section id="time-series" class="level2">
<h2 class="anchored" data-anchor-id="time-series">Time Series</h2>
<section id="load-the-libraries" class="level3">
<h3 class="anchored" data-anchor-id="load-the-libraries">Load the libraries</h3>
<p><br></p>
<p>Before we start, let’s import the data science libraries into Python.</p>
<div id="17f596aa" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, we use specific functions from the <strong>pandas</strong>, <strong>matplotlib</strong>, <strong>seaborn</strong> and <strong>sklearn</strong> libraries in Python.</p>
</section>
<section id="what-is-a-time-series" class="level3">
<h3 class="anchored" data-anchor-id="what-is-a-time-series">What is a time series?</h3>
<p><br></p>
<ul>
<li><p>It is a sequence of observations collected at successive time intervals.</p></li>
<li><p>Time series data is commonly used in finance, economics, weather forecasting, signal processing, and many others.</p></li>
<li><p>Analyzing time series data helps us understand patterns, trends, and behaviors over time, enabling prediction, anomaly detection, and decision-making.</p></li>
</ul>
</section>
<section id="example-1-teslas-stock-price" class="level3">
<h3 class="anchored" data-anchor-id="example-1-teslas-stock-price">Example 1: Tesla’s stock price</h3>
<p><img src="images/Tesla_stock_price.jpg" class="img-fluid"></p>
</section>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section"></h3>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li><p>Technically, a time series is a set of observations about a (discrete) predictor <span class="math inline">\(T\)</span> and a response <span class="math inline">\(Y\)</span>.</p></li>
<li><p>Observations of <span class="math inline">\(Y\)</span> are recorded at the moments or times given by the predictor <span class="math inline">\(T\)</span>.</p></li>
<li><p>The special feature of the time series is that the <span style="color:#4682B4;">observations of <span class="math inline">\(Y\)</span> are not independent!</span></p></li>
</ul>
</div><div class="column" style="width:40%;">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Day</th>
<th>T</th>
<th>Temperature (Y)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Monday</td>
<td>1</td>
<td>10</td>
</tr>
<tr class="even">
<td>Tuesday</td>
<td>2</td>
<td>12</td>
</tr>
<tr class="odd">
<td>Wednesday</td>
<td>3</td>
<td>15</td>
</tr>
<tr class="even">
<td>Thursday</td>
<td>4</td>
<td>14</td>
</tr>
<tr class="odd">
<td>Friday</td>
<td>5</td>
<td>18</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="example-2-amtrak-data" class="level3">
<h3 class="anchored" data-anchor-id="example-2-amtrak-data">Example 2: Amtrak data</h3>
<p><br></p>
<ul>
<li><p>The Amtrak train company in the USA collects data on the number of passengers traveling on its trains.</p></li>
<li><p>Records are available from January 1991 to March 2004.</p></li>
<li><p>The data is available in “Amtrak.xlsx” on Canvas.</p></li>
</ul>
<div id="6bd42a29" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Amtrak_data <span class="op">=</span> pd.read_excel(<span class="st">'Amtrak.xlsx'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-1" class="level3">
<h3 class="anchored" data-anchor-id="section-1"></h3>
<p><br></p>
<div id="77aa7d06" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Amtrak_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Month</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">Ridership (in 000s)</th>
<th data-quarto-table-cell-role="th">Season</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1991-01-01</td>
<td>1</td>
<td>1708.917</td>
<td>Jan</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1991-02-01</td>
<td>2</td>
<td>1620.586</td>
<td>Feb</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1991-03-04</td>
<td>3</td>
<td>1972.715</td>
<td>Mar</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1991-04-04</td>
<td>4</td>
<td>1811.665</td>
<td>Apr</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1991-05-05</td>
<td>5</td>
<td>1974.964</td>
<td>May</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="time-series-plot-in-python" class="level3">
<h3 class="anchored" data-anchor-id="time-series-plot-in-python">Time series plot in Python</h3>
<p>We can create a line graph to visualize the evolution of Amtrak train ridership over time using <code>lineplot</code> from <strong>seaborn</strong>.</p>
<div id="14316871" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span><span class="st">'Month'</span>, y<span class="op">=</span><span class="st">'Ridership (in 000s)'</span>, data <span class="op">=</span> Amtrak_data)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Month'</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Ridership'</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Amtrak Ridership Over Time'</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="TimeSeries_files/figure-revealjs/cell-5-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="560" height="368"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="informative-series" class="level3">
<h3 class="anchored" data-anchor-id="informative-series">Informative Series</h3>
<p><br></p>
<p>An informative time series is a series that contains patterns that we can use to predict future values of the series.</p>
<p>The three possible patterns are:</p>
<div class="incremental">
<ul class="incremental">
<li><span style="color:darkgreen;"><strong>Trend</strong></span>: the series has an <strong>increasing/decreasing</strong> behavior.</li>
<li><span style="color:purple;"><strong>Seasonality</strong></span>: the series has a repeating <strong>cyclical</strong> pattern in its values.</li>
<li><span style="color:darkblue;"><strong>Autocorrelation</strong></span>: the series follows a pattern that can be described by <strong>previous</strong> values of the series.</li>
</ul>
</div>
</section>
<section id="example-3-airline-data" class="level3">
<h3 class="anchored" data-anchor-id="example-3-airline-data">Example 3: Airline data</h3>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><p>This series has an upper <strong>trend</strong>.</p></li>
<li><p>This series has <strong>cyclical</strong> patterns in its values.</p></li>
<li><p>Although not immediately visible, we can use the previous values of the series to describe the future ones.</p></li>
</ul>
</div><div class="column" style="width:50%;">
<div id="10beeb67" class="cell" data-execution_count="5">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="TimeSeries_files/figure-revealjs/cell-6-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="560" height="368"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="non-informative-series-white-noise" class="level3">
<h3 class="anchored" data-anchor-id="non-informative-series-white-noise">Non-informative series: White noise</h3>
<p><br></p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><p>White noise is a series whose values, on average, are <strong>0</strong> and have a constant variation.</p></li>
<li><p>Its values are also independent of each other.</p></li>
<li><p>It is used to describe random or <em>natural</em> error.</p></li>
</ul>
</div><div class="column" style="width:50%;">
<div id="5a5c6aa6" class="cell" data-execution_count="6">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="TimeSeries_files/figure-revealjs/cell-7-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="560" height="368"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="linear-regression-model-for-time-series" class="level2">
<h2 class="anchored" data-anchor-id="linear-regression-model-for-time-series">Linear Regression Model for Time Series</h2>
<section id="linear-regression-model" class="level3">
<h3 class="anchored" data-anchor-id="linear-regression-model">Linear regression model</h3>
<p><br></p>
<p>The linear regression model is useful for capturing patterns in a time series. In this context, the model takes the form:</p>
<p><span class="math display">\[\hat{Y}_i = \hat{\beta}_0 + \hat{\beta}_1 T_i\]</span></p>
<ul>
<li><p>Where <span class="math inline">\(i = 1, \ldots, n_t\)</span> is the index of the <span class="math inline">\(n_t\)</span> training data.</p></li>
<li><p><span class="math inline">\(\hat{Y}_i\)</span> is the prediction of the actual value of the response <span class="math inline">\(Y_i\)</span> <em>at time</em> <span class="math inline">\(T_i\)</span>.</p></li>
</ul>
</section>
<section id="trend" class="level3">
<h3 class="anchored" data-anchor-id="trend">Trend</h3>
<p><br></p>
<p>The trend of the time series is captured by the value of <span class="math inline">\(\hat{\beta}_1\)</span> at</p>
<p><span class="math display">\[\hat{Y}_i = \hat{\beta}_0 + \hat{\beta}_1 T_i\]</span></p>
<ul>
<li><p>If <span class="math inline">\(\hat{\beta}_1\)</span> is positive, the series has an upward trend.</p></li>
<li><p>If <span class="math inline">\(\hat{\beta}_1\)</span> is negative, the series has a downward trend.</p></li>
</ul>
<p>The values of <span class="math inline">\(\hat{\beta}_0\)</span> and <span class="math inline">\(\hat{\beta}_1\)</span> are obtained using the least squares method.</p>
</section>
<section id="model-evaluation" class="level3">
<h3 class="anchored" data-anchor-id="model-evaluation">Model evaluation</h3>
<p><br></p>
<p>Remember that the errors of the linear regression model (<span class="math inline">\(e_i = Y_i - \hat{Y}_i\)</span>) must meet three conditions:</p>
<ol type="1">
<li><p>On average, they must be equal to 0.</p></li>
<li><p>They must have the same dispersion or variability.</p></li>
<li><p>They must be independent of each other.</p></li>
</ol>
<p>In the context of time series, <strong>this means that the model errors</strong> <span class="math inline">\(e_i\)</span> must behave like <span style="color:darkgray;">white noise</span> that contains no patterns.</p>
</section>
<section id="example-2-amtrak-data-cont." class="level3">
<h3 class="anchored" data-anchor-id="example-2-amtrak-data-cont.">Example 2: Amtrak data (cont.)</h3>
<p><br></p>
<p>Let’s fit a linear regression model to the ridership data from Amtrak.</p>
<div id="89e81e2a" class="cell" data-execution_count="7">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="TimeSeries_files/figure-revealjs/cell-8-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="560" height="368"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="creating-a-train-and-a-validation-data" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-train-and-a-validation-data">Creating a train and a validation data</h3>
<p><br></p>
<ul>
<li><p>In time series, the order of the data matters because each observation is tied to a specific point in time.</p></li>
<li><p>Because of this, we cannot randomly split the data using a function like <code>train_test_split()</code>.</p></li>
<li><p>Doing so might result in a situation where the model learns from future values to predict past ones—which doesn’t make sense and would lead to overly optimistic performance.</p></li>
</ul>
</section>
<section id="section-2" class="level3">
<h3 class="anchored" data-anchor-id="section-2"></h3>
<p>Instead, we want to train the model on earlier time periods and test it on later ones.</p>
<p>To this end, we use the code below.</p>
<div id="5a15913d" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the split point</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>split_ratio <span class="op">=</span> <span class="fl">0.8</span>  <span class="co"># 80% train, 20% validation</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>split_point <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(Amtrak_data) <span class="op">*</span> split_ratio)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>Amtrak_train <span class="op">=</span> Amtrak_data[:split_point]</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>Amtrak_validation <span class="op">=</span> Amtrak_data[split_point:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This code ensures that the training data always comes before the validation data in time, preserving the temporal order. The proportion of data that goes to training is set using <code>split_ratio</code>.</p>
</section>
<section id="section-3" class="level3">
<h3 class="anchored" data-anchor-id="section-3"></h3>
<p><br><br></p>
<div id="ec70f61a" class="cell" data-execution_count="9">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="TimeSeries_files/figure-revealjs/cell-10-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="752" height="464"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fit-linear-regression-model" class="level3">
<h3 class="anchored" data-anchor-id="fit-linear-regression-model">Fit linear regression model</h3>
<p>We first set the predictor and response.</p>
<div id="5e9f8e09" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set predictor.</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> Amtrak_train.<span class="bu">filter</span>([<span class="st">'t'</span>])</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set response.</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>Y_train <span class="op">=</span> Amtrak_train.<span class="bu">filter</span>([<span class="st">'Ridership (in 000s)'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Next, we fit the model using <code>LinearRegression()</code> and <code>fit()</code> from <strong>scikit-learn</strong>.</p>
<div id="3d291e07" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Create linear regression model.</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>LRmodelAmtrak <span class="op">=</span> LinearRegression()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Fit the model to the training data.</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>LRmodelAmtrak.fit(X_train, Y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-4" class="level3">
<h3 class="anchored" data-anchor-id="section-4"></h3>
<p><br></p>
<p>Let’s inspect the estimated coefficient for the predictor (<em>time</em>).</p>
<div id="11835a66" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(LRmodelAmtrak.coef_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[-1.2818326]]</code></pre>
</div>
</div>
<p>And the intercept.</p>
<div id="15b1ac8a" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(LRmodelAmtrak.intercept_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1810.77686661]</code></pre>
</div>
</div>
<p>The estimated model then is:</p>
<p><span class="math display">\[\hat{Y}_i = 1810.777 - 1.281 T_i.\]</span></p>
</section>
<section id="residual-analysis" class="level3">
<h3 class="anchored" data-anchor-id="residual-analysis">Residual analysis</h3>
<p><br></p>
<p>We can validate the model using a residual analysis on the training data. To this end, we first compute the predicted values and residuals of the model.</p>
<div id="a692a734" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fitted <span class="op">=</span> LRmodelAmtrak.predict(X_train) <span class="op">+</span> Y_train<span class="op">*</span><span class="dv">0</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> Y_train <span class="op">-</span> fitted</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct a pandas data.frame</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>residual_data <span class="op">=</span> pd.DataFrame()</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>residual_data[<span class="st">"Fitted"</span>] <span class="op">=</span> fitted</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>residual_data[<span class="st">"Residuals"</span>] <span class="op">=</span> residuals</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>residual_data[<span class="st">"Time"</span>] <span class="op">=</span> residuals.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remember that we are using <code>+ Y_train*0</code> to visualize the objects <code>fitted</code> and <code>residuals</code> effectively.</p>
</section>
<section id="section-5" class="level3">
<h3 class="anchored" data-anchor-id="section-5"></h3>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div id="48fdb7bb" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Residual vs Fitted Values Plot</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data <span class="op">=</span> residual_data, x <span class="op">=</span> <span class="st">"Fitted"</span>, y <span class="op">=</span> <span class="st">"Residuals"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Fitted Values (Y_pred)"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Residuals vs. Fitted Values"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="TimeSeries_files/figure-revealjs/cell-16-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="680" height="529"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div id="8e0a404a" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data <span class="op">=</span> residual_data, x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Residuals"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Time"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Residuals vs. Time"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="TimeSeries_files/figure-revealjs/cell-17-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="682" height="529"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="the-model-is-more-flexible-than-that" class="level3">
<h3 class="anchored" data-anchor-id="the-model-is-more-flexible-than-that">The model is more flexible than that</h3>
<p><br></p>
<p>If necessary, the linear regression model can be extended to capture quadratic relationships. For this, the model takes the following form:</p>
<p><span class="math display">\[\hat{Y}_i = \hat{\beta}_0 + \hat{\beta}_1 T_i + \hat{\beta}_2 T^{2}_i \]</span></p>
<ul>
<li><p>Where <span class="math inline">\(T^{2}_i\)</span> is the squared value of the time index.</p></li>
<li><p><span class="math inline">\(\hat{\beta}_2\)</span> is a term that captures possible curvature in the time series.</p></li>
</ul>
</section>
<section id="in-python" class="level3">
<h3 class="anchored" data-anchor-id="in-python">In Python</h3>
<p>To include a quadratic term, we must augment our predictor matrix with an additional column. The following code shows how to augment <code>X_full</code> by the square of the <code>Amtrak_data['t']</code> column. This is done using the <strong>pandas</strong> <code>.concat()</code> function. The resulting matrix is stored in <code>X_quad</code>.</p>
<div id="5388fb7e" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>X_quad <span class="op">=</span> pd.concat([X_train, Amtrak_train[<span class="st">'t'</span>]<span class="op">**</span><span class="dv">2</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we follow the same steps to fit this model.</p>
<div id="e8db73d4" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Create linear regression model</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>QuadmodelAmtrak <span class="op">=</span> LinearRegression()</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Fit linear regression model</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>QuadmodelAmtrak.fit(X_quad, Y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-6" class="level3">
<h3 class="anchored" data-anchor-id="section-6"></h3>
<p><br></p>
<p>We show the estimated coefficients in Python.</p>
<div id="02487e75" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Intercept = "</span>, QuadmodelAmtrak.intercept_)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Coefficients = "</span>, QuadmodelAmtrak.coef_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercept =  [1866.84019635]
Coefficients =  [[-4.64563238  0.03397778]]</code></pre>
</div>
</div>
<p><br></p>
<p>The estimated model thus is</p>
<p><span class="math display">\[\hat{Y}_i = 1866.84 - 4.65 T_i + 0.03 T^2_i.\]</span></p>
</section>
<section id="residual-analysis-1" class="level3">
<h3 class="anchored" data-anchor-id="residual-analysis-1">Residual analysis</h3>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<div id="6f2c5010" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remember to use the same `X_quad`</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>Y_pred_quad <span class="op">=</span> QuadmodelAmtrak.predict(X_quad) <span class="op">+</span> Y_train<span class="op">*</span><span class="dv">0</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>residuals_quad <span class="op">=</span> Y_train <span class="op">-</span> Y_pred_quad</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct a pandas data.frame</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>residual_data_quad <span class="op">=</span> pd.DataFrame()</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>residual_data_quad[<span class="st">"Fitted"</span>] <span class="op">=</span> Y_pred_quad</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>residual_data_quad[<span class="st">"Residuals"</span>] <span class="op">=</span> residuals_quad</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>residual_data_quad[<span class="st">"Time"</span>] <span class="op">=</span> residuals_quad.index</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data <span class="op">=</span> residual_data_quad, x <span class="op">=</span> <span class="st">"Fitted"</span>, y <span class="op">=</span> <span class="st">"Residuals"</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Fitted Values (Y_pred_quad)"</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Residuals vs. Fitted Values"</span>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="TimeSeries_files/figure-revealjs/cell-21-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="680" height="529"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div id="f551e929" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data <span class="op">=</span> residual_data_quad, x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Residuals"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Time (t)"</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Residuals vs. Time"</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="TimeSeries_files/figure-revealjs/cell-22-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="682" height="529"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="model-evaluation-using-validation-data" class="level3">
<h3 class="anchored" data-anchor-id="model-evaluation-using-validation-data">Model evaluation using validation data</h3>
<p><br></p>
<p>Remember that another way to evaluate the performance of a model is using the <span class="math inline">\(\text{MSE}_v\)</span> or <span class="math inline">\(\text{RMSE}_v\)</span> on the validation data.</p>
<p><br></p>
<p>To this end, we need some Python objects.</p>
<div id="e662ec34" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set predictor.</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>X_valid <span class="op">=</span> Amtrak_validation.<span class="bu">filter</span>([<span class="st">'t'</span>])</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set response.</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>Y_valid <span class="op">=</span> Amtrak_validation.<span class="bu">filter</span>([<span class="st">'Ridership (in 000s)'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-7" class="level3">
<h3 class="anchored" data-anchor-id="section-7"></h3>
<p>Let’s compute the <span class="math inline">\(\text{RMSE}_v\)</span> for the linear regression model.</p>
<div id="547b7c0d" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>Y_val_pred_lin <span class="op">=</span> LRmodelAmtrak.predict(X_valid)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>mse <span class="op">=</span> mean_squared_error(Y_valid, Y_val_pred_lin)  </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">round</span>(mse<span class="op">**</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>), <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>250.03</code></pre>
</div>
</div>
<p>Let’s do the same for the the linear regression model with a quadratic term.</p>
<div id="5b481fe7" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>X_quad_valid <span class="op">=</span> pd.concat([X_valid, Amtrak_validation[<span class="st">'t'</span>]<span class="op">**</span><span class="dv">2</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>Y_val_pred_quad <span class="op">=</span> QuadmodelAmtrak.predict(X_quad_valid)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>mse_quad <span class="op">=</span> mean_squared_error(Y_valid, Y_val_pred_quad)  <span class="co"># Mean Squared Error (MSE)</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">round</span>(mse_quad<span class="op">**</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>), <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>173.99</code></pre>
</div>
</div>
<p>We conclude that the linear model with a quadratic term is better than the linear regression model because the <span class="math inline">\(\text{RMSE}_v\)</span> of the former is smaller than for the latter.</p>
</section>
<section id="section-8" class="level3">
<h3 class="anchored" data-anchor-id="section-8"></h3>
<p>Predictions of linear model</p>
<div id="22282052" class="cell" data-execution_count="25">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="TimeSeries_files/figure-revealjs/cell-26-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="944" height="560"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="section-9" class="level3">
<h3 class="anchored" data-anchor-id="section-9"></h3>
<p>Predictions of linear model with quadratic trend</p>
<div id="f4bc8d87" class="cell" data-execution_count="26">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="TimeSeries_files/figure-revealjs/cell-27-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="944" height="560"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="activity-solo-mode" class="level3">
<h3 class="anchored" data-anchor-id="activity-solo-mode">Activity (<em>solo</em> mode)</h3>
<p>The Office of Transportation Statistics of the Innovative Research and Technology Administration conducted a study to assess the impact of the September 11, 2001, terrorist attack on U.S. transportation. The report analyzes monthly passenger movement data from January 1990 to May 2004. Time series data are provided for (1) Real Revenue Passenger Miles Traveled (Air RPM), (2) Rail Passenger Miles Traveled (Rail PM), and (3) Car Miles Traveled (VMT).</p>
<p>In this activity, you will fit different linear regression models to data in the file “Sept11Travel.xlsx” in CANVAS.</p>
</section>
<section id="identifying-heteroskedasticity" class="level3">
<h3 class="anchored" data-anchor-id="identifying-heteroskedasticity">Identifying Heteroskedasticity</h3>
<p><br><br></p>
<p>Heteroskedasticity arises when the dispersion of model errors is not constant over time.</p>
<p>To see it, let’s go back to the Airline data, which contains the number of passengers of an international airline per month between 1949 and 1960.</p>
<div id="c59aad97" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Airline_data <span class="op">=</span> pd.read_excel(<span class="st">"Airline.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-10" class="level3">
<h3 class="anchored" data-anchor-id="section-10"></h3>
<p><br><br></p>
<div id="d941bd7a" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>Airline_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="75">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">T</th>
<th data-quarto-table-cell-role="th">Number of passengers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>112</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>118</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>132</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>129</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>121</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="section-11" class="level3">
<h3 class="anchored" data-anchor-id="section-11"></h3>
<p>For illustrative purposes, we will not split the time series into training and validation datasets.</p>
<div id="9b581db2" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span><span class="st">'T'</span>, y<span class="op">=</span><span class="st">'Number of passengers'</span>, data <span class="op">=</span> Airline_data)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Time'</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Number of passengers'</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Number of passengers across time'</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="TimeSeries_files/figure-revealjs/cell-30-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="944" height="464"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="section-12" class="level3">
<h3 class="anchored" data-anchor-id="section-12"></h3>
<p><br><br></p>
<p>Let’s fit a linear regression model.</p>
<div id="b6b76fe2" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set predictor.</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>X_full <span class="op">=</span> Airline_data.<span class="bu">filter</span>([<span class="st">'T'</span>])</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set response.</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>Y_full <span class="op">=</span> Airline_data.<span class="bu">filter</span>([<span class="st">'Number of passengers'</span>])</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Create linear regression</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>LRmodelAirline <span class="op">=</span> LinearRegression()</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Fit the model</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>LRmodelAirline.fit(X_full, Y_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="residual-analysis-2" class="level3">
<h3 class="anchored" data-anchor-id="residual-analysis-2">Residual analysis</h3>
<div style="font-size: 90%;">
<p><strong>Heteroskedasticity</strong>: Dispersion of the residuals increases with the predicted value.</p>
</div>
<div id="a83859e0" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remember to use the same `X_quad`</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>Y_pred <span class="op">=</span> LRmodelAirline.predict(X_full) <span class="op">+</span> Y_full<span class="op">*</span><span class="dv">0</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> Y_full <span class="op">-</span> Y_pred</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct a pandas data.frame</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>residual_data <span class="op">=</span> pd.DataFrame()</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>residual_data[<span class="st">"Fitted"</span>] <span class="op">=</span> Y_pred</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>residual_data[<span class="st">"Residuals"</span>] <span class="op">=</span> residuals</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>residual_data[<span class="st">"Time"</span>] <span class="op">=</span> residuals.index</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data <span class="op">=</span> residual_data, x <span class="op">=</span> <span class="st">"Fitted"</span>, y <span class="op">=</span> <span class="st">"Residuals"</span>)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Fitted Values (Y_pred_quad)"</span>)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Residuals vs. Fitted Values"</span>)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="TimeSeries_files/figure-revealjs/cell-32-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="531" height="381"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="solution" class="level3">
<h3 class="anchored" data-anchor-id="solution">Solution</h3>
<p><br></p>
<p>If we identify heteroskedasticity in the regression model errors, we have several transformation options for our <strong>original</strong> series.</p>
<ul>
<li><p>A common transformations to the time series <span class="math inline">\(Y_i\)</span> is the <strong>Natural Logarithm</strong></p></li>
<li><p>If the original time series contains negative values, it can be <strong>lagged</strong> by adding the negative of its minimum value.</p></li>
</ul>
</section>
<section id="in-python-1" class="level3">
<h3 class="anchored" data-anchor-id="in-python-1">In Python</h3>
<p>The easiest way to apply the logarithm in Python is to use the <code>log()</code> function from the <strong>numpy</strong> library</p>
<div id="6686a300" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>log_Y_full <span class="op">=</span> np.log( Y_full )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, the response to use is in <code>log_Y_full</code>.</p>
<p><br></p>
<p>The steps to fit a linear regression model are similar.</p>
<div id="019ab4e4" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Create linear regression</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>LRmodelAirlineTransformed <span class="op">=</span> LinearRegression()</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Fit the model</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>LRmodelAirlineTransformed.fit(X_full, log_Y_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="residual-analysis-3" class="level3">
<h3 class="anchored" data-anchor-id="residual-analysis-3">Residual analysis</h3>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<p>With transformation</p>
<div id="41bc074d" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remember to use the same `X_quad`</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>Y_pred_log <span class="op">=</span> LRmodelAirlineTransformed.predict(X_full) <span class="op">+</span> log_Y_full<span class="op">*</span><span class="dv">0</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>residuals_log <span class="op">=</span> log_Y_full <span class="op">-</span> Y_pred_log</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct a pandas data.frame</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>residual_data_log <span class="op">=</span> pd.DataFrame()</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>residual_data_log[<span class="st">"Fitted"</span>] <span class="op">=</span> Y_pred_log</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>residual_data_log[<span class="st">"Residuals"</span>] <span class="op">=</span> residuals_log</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>residual_data_log[<span class="st">"Time"</span>] <span class="op">=</span> residuals_log.index</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data <span class="op">=</span> residual_data_log, x <span class="op">=</span> <span class="st">"Fitted"</span>, y <span class="op">=</span> <span class="st">"Residuals"</span>)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Fitted Values (Y_pred_quad)"</span>)</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Residuals vs. Fitted Values"</span>)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="TimeSeries_files/figure-revealjs/cell-35-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="527" height="381"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>Without transformation</p>
<div id="dc990875" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remember to use the same `X_quad`</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>Y_pred <span class="op">=</span> LRmodelAirline.predict(X_full) <span class="op">+</span> Y_full<span class="op">*</span><span class="dv">0</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> Y_full <span class="op">-</span> Y_pred</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct a pandas data.frame</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>residual_data <span class="op">=</span> pd.DataFrame()</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>residual_data[<span class="st">"Fitted"</span>] <span class="op">=</span> Y_pred</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>residual_data[<span class="st">"Residuals"</span>] <span class="op">=</span> residuals</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>residual_data[<span class="st">"Time"</span>] <span class="op">=</span> residuals.index</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data <span class="op">=</span> residual_data, x <span class="op">=</span> <span class="st">"Fitted"</span>, y <span class="op">=</span> <span class="st">"Residuals"</span>)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Fitted Values (Y_pred_quad)"</span>)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Residuals vs. Fitted Values"</span>)</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="TimeSeries_files/figure-revealjs/cell-36-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="531" height="381"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="what-do-i-do-if-the-transformation-doesnt-work" class="level3">
<h3 class="anchored" data-anchor-id="what-do-i-do-if-the-transformation-doesnt-work">What do I do if the transformation doesn’t work?</h3>
<p><br></p>
<ul>
<li><p>If the log transformation doesn’t significantly reduce heteroskedasticity, there are models for modeling variance called GARCH.</p></li>
<li><p>You can find literature on these models and their software implementations in a time series textbook such as <em>Time Series Analysis with Applications in R</em> by Cryer and Chan.</p></li>
</ul>
</section>
</section>
<section id="models-with-seasonality" class="level2">
<h2 class="anchored" data-anchor-id="models-with-seasonality">Models with Seasonality</h2>
<section id="seasonality" class="level3">
<h3 class="anchored" data-anchor-id="seasonality">Seasonality</h3>
<p>Seasonality refers to repetitive or cyclical behavior that occurs with a constant frequency.</p>
<div class="center">
<div class="columns">
<div class="column" style="width:50%;">
<p><br></p>
<p>Examples:</p>
<ul>
<li><p>Demand for winter clothing</p></li>
<li><p>Demand for tourist travel</p></li>
<li><p>Amount of rainfall throughout the year.</p></li>
</ul>
</div><div class="column" style="width:50%;">
<div id="00477950" class="cell" data-execution_count="36">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="TimeSeries_files/figure-revealjs/cell-37-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="464" height="464"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="capturing-seasonality" class="level3">
<h3 class="anchored" data-anchor-id="capturing-seasonality">Capturing seasonality</h3>
<div class="center">
<div class="columns">
<div class="column" style="width:60%;">
<p>The linear regression model can be extended to capture seasonal patterns in the time series.</p>
<p>To do this, an additional categorical predictor is created that indicates the season to which each data item belongs.</p>
<p>The additional categorical predictor is transformed into several auxiliary numerical predictors.</p>
</div><div class="column" style="width:40%;">
<p><br></p>
<p><img src="images/clipboard-2320382344.png" class="img-fluid"></p>
</div>
</div>
</div>
</section>
<section id="analyzing-seasonal-series-in-python" class="level3">
<h3 class="anchored" data-anchor-id="analyzing-seasonal-series-in-python">Analyzing seasonal series in Python</h3>
<p>Consider the data in <code>Amtrak_train</code> with the additional predictor of <code>Season</code> to model seasonality.</p>
<div id="97ac8dbf" class="cell" data-execution_count="37">
<div class="cell-output cell-output-display" data-execution_count="84">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Month</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">Ridership (in 000s)</th>
<th data-quarto-table-cell-role="th">Season</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1991-01-01</td>
<td>1</td>
<td>1708.917</td>
<td>Jan</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1991-02-01</td>
<td>2</td>
<td>1620.586</td>
<td>Feb</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1991-03-04</td>
<td>3</td>
<td>1972.715</td>
<td>Mar</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1991-04-04</td>
<td>4</td>
<td>1811.665</td>
<td>Apr</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1991-05-05</td>
<td>5</td>
<td>1974.964</td>
<td>May</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="section-13" class="level3">
<h3 class="anchored" data-anchor-id="section-13"></h3>
<p>To fit a linear regression model with a categorical variable like <code>Season</code>, we must transform the text categories into numbers. To do this, we use dummy variables constructed using the following commands.</p>
<div id="b3b20081" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>dummy_data <span class="op">=</span> pd.get_dummies(Amtrak_train[<span class="st">'Season'</span>], dtype <span class="op">=</span> <span class="st">'int'</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>dummy_data.head(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="85">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Apr</th>
<th data-quarto-table-cell-role="th">Aug</th>
<th data-quarto-table-cell-role="th">Dec</th>
<th data-quarto-table-cell-role="th">Feb</th>
<th data-quarto-table-cell-role="th">Jan</th>
<th data-quarto-table-cell-role="th">Jul</th>
<th data-quarto-table-cell-role="th">Jun</th>
<th data-quarto-table-cell-role="th">Mar</th>
<th data-quarto-table-cell-role="th">May</th>
<th data-quarto-table-cell-role="th">Nov</th>
<th data-quarto-table-cell-role="th">Oct</th>
<th data-quarto-table-cell-role="th">Sep</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="section-14" class="level3">
<h3 class="anchored" data-anchor-id="section-14"></h3>
<p>The matrix above contains one column for each month. Each column indicates the observations that belong to the month of the column. For example, the column <code>Apr</code> has the values 0 and 1. The value 1 indicates that the corresponding observation belongs to the month of April. A 0 indicates otherwise.</p>
<div id="90b846f0" class="cell" data-execution_count="39">
<div class="cell-output cell-output-display" data-execution_count="86">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Apr</th>
<th data-quarto-table-cell-role="th">Aug</th>
<th data-quarto-table-cell-role="th">Dec</th>
<th data-quarto-table-cell-role="th">Feb</th>
<th data-quarto-table-cell-role="th">Jan</th>
<th data-quarto-table-cell-role="th">Jul</th>
<th data-quarto-table-cell-role="th">Jun</th>
<th data-quarto-table-cell-role="th">Mar</th>
<th data-quarto-table-cell-role="th">May</th>
<th data-quarto-table-cell-role="th">Nov</th>
<th data-quarto-table-cell-role="th">Oct</th>
<th data-quarto-table-cell-role="th">Sep</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="section-15" class="level3">
<h3 class="anchored" data-anchor-id="section-15"></h3>
<p><br></p>
<p>Unfortunately, we cannot use the matrix as is in the linear regression model due to <strong>multicollinearity</strong> issues. Technically, this happens because if you add all the columns, the resulting column is a column of 1s, which is already used by the intercept. Therefore, you cannot fit a model with the intercept and all the columns of the dummy variables.</p>
<p><br></p>
<p>To solve this problem, we arbitrarily remove a column from the matrix above. For example, let’s remove <code>Dec</code>.</p>
<div id="b19eb0c8" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>dummy_data <span class="op">=</span> dummy_data.drop([<span class="st">"Dec"</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-16" class="level3">
<h3 class="anchored" data-anchor-id="section-16"></h3>
<p>Now, let’s build the complete matrix of predictors, including the column for time, time squared, and the dummy variables.</p>
<div id="95e51bb9" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>X_quad_season <span class="op">=</span> pd.concat([Amtrak_train[<span class="st">'t'</span>], Amtrak_train[<span class="st">'t'</span>]<span class="op">**</span><span class="dv">2</span>, dummy_data], </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>                          axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Next, we fit the model with all the terms in the matrix above.</p>
<div id="a2e17086" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 0. Ensure that we have the response in `Y_full`.</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>Y_train <span class="op">=</span> Amtrak_train[<span class="st">'Ridership (in 000s)'</span>]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Create linear regression model.</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>SeasonmodelAmtrak <span class="op">=</span> LinearRegression()</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Fit the linear regression model.</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>SeasonmodelAmtrak.fit(X_quad_season, Y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="estimated-model-coefficients" class="level3">
<h3 class="anchored" data-anchor-id="estimated-model-coefficients">Estimated model coefficients</h3>
<p><br></p>
<div id="c46cbdc1" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Intercept = "</span>, SeasonmodelAmtrak.intercept_)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Coefficients = "</span>, SeasonmodelAmtrak.coef_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercept =  1924.3205889003025
Coefficients =  [-6.12171259e+00  4.96085283e-02  1.22309969e+01  1.77720172e+02
 -2.83088245e+02 -2.25659158e+02  1.15685204e+02 -7.31735621e+00
  1.59876604e+01  5.17037414e+01 -4.77796001e+01 -3.19949172e+01
 -1.45366826e+02]</code></pre>
</div>
</div>
</section>
<section id="residual-analysis-4" class="level3">
<h3 class="anchored" data-anchor-id="residual-analysis-4">Residual analysis</h3>
<div id="ffbc2d82" class="cell" data-execution_count="44">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>Y_pred <span class="op">=</span> SeasonmodelAmtrak.predict(X_quad_season)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> Y_train <span class="op">-</span> Y_pred</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>Amtrak_data[<span class="st">'t'</span>], y<span class="op">=</span>residuals)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Time (t)"</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Residuals vs. Time"</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="TimeSeries_files/figure-revealjs/cell-45-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="680" height="529"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="predictions-on-the-validation-dataset" class="level3">
<h3 class="anchored" data-anchor-id="predictions-on-the-validation-dataset">Predictions on the validation dataset</h3>
<p>Prepare the validation data using dummy variables.</p>
<div id="1a537937" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>Y_valid <span class="op">=</span> Amtrak_validation[<span class="st">'Ridership (in 000s)'</span>]</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>dummy_valid <span class="op">=</span> pd.get_dummies(Amtrak_validation[<span class="st">'Season'</span>], dtype <span class="op">=</span> <span class="st">'int'</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>dummy_valid <span class="op">=</span> dummy_valid.drop([<span class="st">"Dec"</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>X_qs_valid <span class="op">=</span> pd.concat([Amtrak_validation[<span class="st">'t'</span>], Amtrak_validation[<span class="st">'t'</span>]<span class="op">**</span><span class="dv">2</span>, </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>                        dummy_valid], axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Now, we compute the validation <span class="math inline">\(\text{RMSE}_v\)</span>.</p>
<div id="bec49d70" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>Y_pred_valid <span class="op">=</span> SeasonmodelAmtrak.predict(X_qs_valid)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>mse_season <span class="op">=</span> mean_squared_error(Y_valid, Y_pred_valid) </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">round</span>(mse_season<span class="op">**</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>), <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>69.93</code></pre>
</div>
</div>
</section>
<section id="section-17" class="level3">
<h3 class="anchored" data-anchor-id="section-17"></h3>
<p>Predictions of the linear model with seasonality.</p>
<div id="97caf98e" class="cell" data-execution_count="47">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="TimeSeries_files/figure-revealjs/cell-48-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="944" height="560"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="disadvantages-of-linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="disadvantages-of-linear-regression">Disadvantages of linear regression</h3>
<p><br></p>
<ul>
<li><p>Despite their simplicity and versatility, linear regression models are not the best for describing a time series.</p></li>
<li><p>This is because they do not assume a dependency between consecutive values in the time series. That is, they do not use the fact that, for example, <span class="math inline">\(Y_1\)</span> can help us predict <span class="math inline">\(Y_2\)</span>, and <span class="math inline">\(Y_2\)</span> can help us predict <span class="math inline">\(Y_3\)</span>, etc.</p></li>
<li><p>Models that help us use past observations to predict future values of the response variable <span class="math inline">\(Y\)</span> are <strong>autoregressive models</strong>.</p></li>
</ul>
</section>
<section id="yogi-berra" class="level3">
<h3 class="anchored" data-anchor-id="yogi-berra">Yogi Berra</h3>
<p><br><br><br></p>
<blockquote class="blockquote">
<p>It’s though to make predictions, especially about the future.</p>
</blockquote>
</section>
</section>
<section id="return-to-main-page" class="level2">
<h2 class="anchored" data-anchor-id="return-to-main-page"><a href="https://alanrvazquez.github.io/TEC-IN2004B/">Return to main page</a></h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>